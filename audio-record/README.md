# `JavaScript` Audio Recording App :metal:

Let's develop an audio recording app.

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º:

- –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ;
- –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –µ–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è;
- —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—É–¥–∏–æ-—Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ;
- –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ-—Ñ–∞–π–ª–æ–≤, —Ö—Ä–∞–Ω—è—â–∏—Ö—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∏ –∏—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è, –∫–æ—Ç–æ—Ä—É—é –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, —ç—Ç–æ [`MediaDevices`](https://developer.mozilla.org/ru/docs/Web/API/MediaDevices). –î–∞–Ω–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –≤—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–∞–≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ [`Navigator`](https://developer.mozilla.org/ru/docs/Web/API/Navigator). –û—Å–Ω–æ–≤–Ω—ã–º –º–µ—Ç–æ–¥–æ–º, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–º —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —è–≤–ª—è–µ—Ç—Å—è [`getUserMedia()`](https://developer.mozilla.org/ru/docs/Web/API/MediaDevices/getUserMedia). –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö (–≤ –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞—è—Ö) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ [`MediaRecorder`](https://developer.mozilla.org/ru/docs/Web/API/MediaRecorder).

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `MediaDevices` –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å [–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–º–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏](https://caniuse.com/mdn-api_mediadevices).

–î–ª—è –Ω–µ–±–æ–ª—å—à–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è [Sass](https://sass-lang.com/).

–í—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

<img src="https://habrastorage.org/webt/ir/jf/wt/irjfwtcq6wdrpmsmqdakiy4riig.png" />
<br />

–û—Å–Ω–æ–≤–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ –¥–ª—è –º–µ–Ω—è –ø–æ—Å–ª—É–∂–∏–ª–∞ [—ç—Ç–∞ –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è](https://www.sitepoint.com/mediastream-api-record-audio/).

–í—ã –≥–æ—Ç–æ–≤—ã? –¢–æ–≥–¥–∞ –≤–ø–µ—Ä–µ–¥!
<cut />
–ù–∞—á–Ω–µ–º —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.

## –°–µ—Ä–≤–µ—Ä

–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
# —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir record-app
# –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ
cd !$

# –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
# `-y` –æ–∑–Ω–∞—á–∞–µ—Ç –≤—ã–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
yarn init -y
# –∏–ª–∏
npm init -y

# —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
yarn add express multer
# –∏–ª–∏
npm i ...

# —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
yarn add concurrently nodemon open-cli sass
```

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

- [`express`](https://expressjs.com/ru/) - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è `Node.js`, –æ–±–ª–µ–≥—á–∞—é—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É `REST API`
- [`multer`](https://github.com/expressjs/multer/blob/master/doc/README-ru.md) - –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ [`busboy`](https://www.npmjs.com/package/busboy) –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ `multipart/form-data`, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- [`concurrently`](https://www.npmjs.com/package/concurrently) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤ `package.json`
- [`nodemon`](https://www.npmjs.com/package/nodemon) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å–µ—Ä–≤–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞–±–ª—é–¥–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤)
- [`open-cli`](https://www.npmjs.com/package/open-cli) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∞–¥—Ä–µ—Å—É
- [`sass`](https://www.npmjs.com/package/sass) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è `SASS` –≤ `CSS`

–û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ `package.json`:

```json
"scripts": {
 "sass": "sass --no-source-map --watch public/style.scss:public/style.css",
 "server": "open-cli http://localhost:3000 && nodemon index.js",
 "start": "concurrently \"yarn sass\" \"yarn server\""
}
```

–ö–æ–º–∞–Ω–¥—ã:

- –∫–æ–º–∞–Ω–¥–∞ `sass` –∑–∞–ø—É—Å–∫–∞–µ—Ç —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ `public/style.scss` –≤ —Ñ–∞–π–ª `public/style.css` –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (`--watch`) –∏ –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (`--no-source-map`)
- –∫–æ–º–∞–Ω–¥–∞ `server` –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–∫–ª–∞–¥–∫—É –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000`
- –∫–æ–º–∞–Ω–¥–∞ `start` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã `sass` –∏ `server`

–í –∫–æ–¥–µ —Å–µ—Ä–≤–µ—Ä–∞ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ES6-–º–æ–¥—É–ª–∏ (`import/export`), –ø–æ—ç—Ç–æ–º—É –æ–ø—Ä–µ–¥–µ–ª–∏–º –≤ `package.json` —Ç–∏–ø –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∫–∞–∫ –º–æ–¥—É–ª—å:

```json
"type": "module"
```

–í –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –¥–ª—è –∫–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.mjs`.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```
- record-app
 - node_modules
 - public - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ (–∫–ª–∏–µ–Ω—Ç)
   - img
     - microphone.png
     - pause.png
     - play.png
     - stop.png
   - index.html
   - script.js
   - style.scss
 - uploads - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∞—É–¥–∏–æ-—Ñ–∞–π–ª–æ–≤
 - index.js - —Å–µ—Ä–≤–µ—Ä
 - package.json
```

–ü—Ä–∏—Å—Ç—É–ø–∞–µ–º –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å –Ω–∞—à —Å–µ—Ä–≤–µ—Ä? –ú–Ω–æ–≥–æ–≥–æ –æ—Ç –Ω–µ–≥–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è: –≤—Å–µ, —á—Ç–æ –æ–Ω –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å - —ç—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π `public` –∏ `uploads`, –∞ —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∞—É–¥–∏–æ-—Ñ–∞–π–ª—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É –∫–ª–∏–µ–Ω—Ç–∞.

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏:

```javascript
import express from 'express'
import { dirname } from 'path'
import { fileURLToPath } from 'url'
import { promises as fs } from 'fs'
import multer from 'multer'
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–π (—Ä–∞–±–æ—á–µ–π) –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

```javascript
const __dirname = dirname(fileURLToPath(import.meta.url))
```

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º `multer`:

```javascript
const upload = multer({
 storage: multer.diskStorage({
   // –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ñ–∞–π–ª–æ–≤
   destination(req, file, cb) {
     cb(null, 'uploads/')
   },
   // –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
   filename(req, file, cb) {
     cb(null, `${file.originalname}.mp3`)
   }
 })
})
```

–°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `express` –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏:

```javascript
const app = express()
app.use(express.static('public'))
app.use(express.static('uploads'))
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ —Å –ø–æ–º–æ—â—å—é `multer`, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–∞ (middleware). –ê—É–¥–∏–æ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –º–µ—Ç–æ–¥–æ–º `POST` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `multipart/form-data` –ø–æ –∞–¥—Ä–µ—Å—É `/save`:

```javascript
// –ø–æ–ª–µ, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ —Ñ–∞–π–ª, –¥–æ–ª–∂–Ω–æ –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è `audio`
app.post('/save', upload.single('audio'), (req, res) => {
 // –≤ –æ—Ç–≤–µ—Ç –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ç—É—Å `201`,
 // —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É—é—â–∏–π –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
 res.sendStatus(201)
})
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º "—Ä–æ—É—Ç" –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∞—É–¥–∏–æ –∏ –∏—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç—É (–º–µ—Ç–æ–¥ - `GET`, –∞–¥—Ä–µ—Å - `/records`):

```javascript
app.get('/records', async (req, res) => {
 try {
   // —á–∏—Ç–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `uploads`
   let files = await fs.readdir(`${__dirname}/uploads`)
   // –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.mp3`
   files = files.filter((fileName) => fileName.split('.')[1] === 'mp3')
   // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç—É
   res.status(200).json(files)
 } catch (e) {
   console.log(e)
 }
})
```

–ù–∞–∫–æ–Ω–µ—Ü, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3000`) –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä:

```javascript
const port = process.env.PORT || 3000
app.listen(port, () => {
 console.log('üöÄ')
})
```

–ù–∞ —ç—Ç–æ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º –º—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∫–ª–∏–µ–Ω—Ç—É.

## –ö–ª–∏–µ–Ω—Ç

–í–µ—Å—å –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `public`.

–ù–∞—á–Ω–µ–º —Å —Ä–∞–∑–º–µ—Ç–∫–∏ (`index.html`).

```html
<head>
 <title>Record App</title>
 <!-- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –º—ã –ø–æ–¥–∫–ª—é—á–∞–µ–º —Ñ–∞–π–ª —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.css` -->
 <!-- –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ —Å—Ç–∏–ª–∏ –±—É–¥–µ–º –ø–∏—Å–∞—Ç—å –≤ —Ñ–∞–π–ª–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.scss` -->
 <link href="style.css" rel="stylesheet" />
</head>
<body>
 <header>
   <h1>Record App</h1>
 </header>

 <main>
   <!-- –∫–Ω–æ–ø–∫–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏ -->
   <button class="btn" id="record_btn">
     <img src="img/microphone.png" alt="record" id="record_img" />
   </button>

   <!-- —Ä–∞–∑–¥–µ–ª –¥–ª—è –∑–∞–ø–∏—Å–µ–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ -->
   <section>
     <h2>My Records</h2>
     <div id="records_box"></div>
   </section>

   <!-- —Ä–∞–∑–¥–µ–ª –¥–ª—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ -->
   <section id="record_box">
     <h2>My Record</h2>
     <!-- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ -->
     <div id="audio_box"></div>
     <!-- –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ -->
     <div class="action_box">
       <button class="btn btn_success" id="save_btn">Save</button>
       <button class="btn btn_danger" id="remove_btn">Remove</button>
     </div>
   </section>
 </main>

 <footer>&copy;&nbsp;</footer>

 <script src="script.js"></script>
</body>
```

_–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã. –ü–æ—Å–∫–æ–ª—å–∫—É DOM-—ç–ª–µ–º–µ–Ω—Ç—ã —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `window`, –º—ã —Å–º–æ–∂–µ–º –ø–æ–ª—É—á–∞—Ç—å –∫ –Ω–∏–º –¥–æ—Å—Ç—É–ø –Ω–∞–ø—Ä—è–º—É—é, —Ç.–µ. –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –ø—É—Ç–µ–º –≤—ã–∑–æ–≤–∞ —Ç–∞–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –∫–∞–∫ `querySelector()`.

–°–¥–µ–ª–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫—Ä–∞—Å–∏–≤—ã–º (`style.scss`):

```scss
// –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≥—É–≥–ª-—à—Ä–∏—Ñ—Ç
@import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');

// –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
// –ø–∞–ª–∏—Ç—Ä—É —è –ø–æ–∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–ª —É `Bootstrap`
$primary: #0275d8;
$success: #5cb85c;
$info: #5bc0de;
$danger: #d9534f;
$dark: #292b2c;
$light: #f7f7f7;

// –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∏–∫—Å–∏–Ω - "–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π" –±–ª–æ–∫ –∫–æ–¥–∞
@mixin flex-center {
 display: flex;
 justify-content: center;
 align-items: center;
}

// —Å–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π
* {
 margin: 0;
 padding: 0;
 box-sizing: border-box;
 font-family: 'Montserrat', sans-serif;
 font-size: 1rem;
 // –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
 color: $light;
}

// –æ–±—â–∏–µ —Å—Ç–∏–ª–∏
body {
 // –ø—Ä–∏–º–µ–Ω—è–µ–º –º–∏–∫—Å–∏–Ω
 @include flex-center;
 flex-direction: column;
 min-height: 100vh;
 background-color: $dark;
 text-align: center;
}

// —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–∂–∞—Ç—å —Ñ—É—Ç–µ—Ä –∫ –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
main {
 flex: 1;
}

h1 {
 margin: 1rem 0;
 font-size: 1.8rem;
}

h2 {
 margin: 0.75rem 0;
 font-size: 1.4rem;
}

// —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
.btn {
 padding: 0.5rem 1rem;
 border: none;
 outline: none;
 border-radius: 4px;
 font-weight: bold;
 letter-spacing: 1px;
 cursor: pointer;
 user-select: none;
 transition: 0.2s ease-in-out;

 // `&` - —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
 &_success {
   background-color: $success;
 }
 &_danger {
   background-color: $danger;
 }
 &:hover {
   background-color: $info;
   color: $dark;
 }
}

#record_btn {
 width: 100px;
 border-radius: 15%;
}

img {
 width: 100%;
}

// –ø—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
@keyframes show {
 from {
   opacity: 0;
   visibility: hidden;
   z-index: -1;
 }
 to {
   opacity: 1;
   visibility: visible;
   z-index: 1;
 }
}
@keyframes hide {
 from {
   opacity: 1;
   visibility: visible;
   z-index: 1;
 }
 to {
   opacity: 0;
   visibility: hidden;
   z-index: -1;
 }
}

// –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
#record_box {
 opacity: 0;
 visibility: hidden;
 z-index: -1;
}

// –∫–ª–∞—Å—Å—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
.show {
 animation: show 0.4s linear forwards;
}

.hide {
 animation: hide 0.4s linear forwards;
}

.action_box {
 margin: 1rem 0;
}

#records_box {
 // —Å–Ω–æ–≤–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º –º–∏–∫—Å–∏–Ω - "–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å" –≤ –¥–µ–π—Å—Ç–≤–∏–∏
 @include flex-center;
}

.audio_item {
 margin: 0.5rem;
 max-width: 320px;
 @include flex-center;

 // —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–±—â–∏—Ö —Å—Ç–∏–ª–µ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∑–∞ —Å—á–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
 .btn {
   @include flex-center;
   width: 50px;
   background-color: $primary;
   margin-right: 0.5rem;
 }
}

footer {
 margin: 0.5rem 0;
}
```

–ù–∞–∫–æ–Ω–µ—Ü, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ç–æ–º—É, —Ä–∞–¥–∏ —á–µ–≥–æ –º—ã, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, –∑–¥–µ—Å—å —Å–æ–±—Ä–∞–ª–∏—Å—å. –Ø, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, –∏–º–µ—é –≤–≤–∏–¥—É –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç. –ù–æ —Å–Ω–∞—á–∞–ª–∞ –∫—Ä–∞—Ç–∫–æ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `MediaDevices` –∏ –µ–≥–æ –º–µ—Ç–æ–¥–µ `getUserMedia()`.

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `MediaDevices` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –º–µ–¥–∏–∞-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–∞–∫–∏–º –∫–∞–∫ –∫–∞–º–µ—Ä–∞, –º–∏–∫—Ä–æ—Ñ–æ–Ω, –∞ —Ç–∞–∫–∂–µ –∫ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —ç–∫—Ä–∞–Ω–∞. –†–∞–∑—É–º–µ–µ—Ç—Å—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —Ç–∞–∫–æ–π –¥–æ—Å—Ç—É–ø. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è [`Media Capture and Streams`](https://w3c.github.io/mediacapture-main/) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ–≤–æ–ª—å–Ω–æ –∂–µ—Å—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —ç—Ç–æ—Ç —Å—á–µ—Ç.

–ú–µ—Ç–æ–¥ `getUserMedia()` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–∫–∞–º–µ—Ä–∞, –º–∏–∫—Ä–æ—Ñ–æ–Ω). –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –ø–æ—Ç–æ–∫ (–æ–±—ä–µ–∫—Ç `MediaStream`), –∫–æ—Ç–æ—Ä—ã–π  —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ–∫–æ–≤ (–¥–æ—Ä–æ–∂–µ–∫), —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö —Ç—Ä–µ–±—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ. –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–æ–±—ä–µ–∫—Ç `MediaStreamConstraints`), –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π, –∫–∞–∫–∏–µ —Ç–∏–ø—ã –º–µ–¥–∏–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è, –∞ —Ç–∞–∫–∂–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞.

–í –æ–±—â–µ–º –≤–∏–¥–µ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```javascript
// –º—ã –±—É–¥–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –∞—É–¥–∏–æ
const constraints = { audio: true, video: true }
let stream = null
navigator.mediaDevices.getUserMedia(constraints)
 .then((_stream) => { stream = _stream })
 // –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞, –∑–Ω–∞—á–∏—Ç, –ª–∏–±–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª –≤ –¥–æ—Å—Ç—É–ø–µ,
 // –ª–∏–±–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–µ –º–µ–¥–∏–∞-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
 .catch((err) => { console.error(`Not allowed or not found: ${err}`) })
```

`MediaRecorder` - —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `MediaStream Recording API` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø–∏—Å–∏ –º–µ–¥–∏–∞. –ù–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç —Ç–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –∫–∞–∫ `start()` –∏ `stop()`, —Å–≤–æ–π—Å—Ç–≤–æ `state`, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–ø–∏—Å–∏, –∞ —Ç–∞–∫–∂–µ —Å–æ–±—ã—Ç–∏–µ `dataavailable`, –≤–æ–∑–Ω–∏–∫–∞—é—â–µ–µ –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é –∑–∞–ø–∏—Å–∏.

–û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∑–∞–±–∞–≤—ã —Ä–∞–¥–∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –ø–æ–¥–≤–∞–ª —Ç–µ–∫—É—â–∏–π –≥–æ–¥:

```javascript
let chunks = []
let mediaRecorder = null
let audioBlob = null

document.querySelector('footer').textContent += new Date().getFullYear()
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è DOM-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ —Å–º–µ–Ω—ã CSS-–∫–ª–∞—Å—Å–æ–≤:

```javascript
// —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å —Ç–µ–≥–æ–º —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞,
// –¥–æ—á–µ—Ä–Ω–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ –∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
const createEl = ({ tag = 'div', children, ...attrs }) => {
 // —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
 const el = document.createElement(tag)

 // –µ—Å–ª–∏ –∏–º–µ—é—Ç—Å—è –∞—Ç—Ä–∏–±—É—Ç—ã
 if (Object.keys(attrs).length > 0) {
   // –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö –∫ —ç–ª–µ–º–µ–Ω—Ç—É
   Object.entries(attrs).forEach(([attr, val]) => {
     el[attr] = val
   })
 }

 // –µ—Å–ª–∏ –∏–º–µ—é—Ç—Å—è –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
 if (children) {
   // –ø—Ä–∏–±–µ–≥–∞–µ–º –∫ —Ä–µ–∫—É—Ä—Å–∏–∏
   children.forEach((_el) => {
     el.append(createEl(_el))
   })
 }

 // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
 return el
}

// —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç, –Ω–æ–≤—ã–π –∏ —Å—Ç–∞—Ä—ã–π CSS-–∫–ª–∞—Å—Å—ã
const toggleClass = (el, oldC, newC) => {
 el.classList.remove(oldC)
 el.classList.add(newC)
}
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏:

```javascript
async function startRecord() {
 // –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
 if (!navigator.mediaDevices && !navigator.mediaDevices.getUserMedia) {
   return console.warn('Not supported')
 }

 // –º–µ–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è `mediaRecorder`
 record_img.src = `img/${
   mediaRecorder && mediaRecorder.state === 'recording' ? 'microphone' : 'stop'
 }.png`

 // –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
 if (!mediaRecorder) {
   try {
     // –ø–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫ –∞—É–¥–∏–æ-–¥–∞–Ω–Ω—ã—Ö
     const stream = await navigator.mediaDevices.getUserMedia({
       audio: true
     })
     // —Å–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä `MediaRecorder`, –ø–µ—Ä–µ–¥–∞–≤–∞—è –µ–º—É –ø–æ—Ç–æ–∫ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
     mediaRecorder = new MediaRecorder(stream)
     // –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å
     mediaRecorder.start()
     // –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é –∑–∞–ø–∏—Å–∏ –∏ –Ω–∞–ª–∏—á–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–ª—è–µ–º —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–∞—Å—Å–∏–≤
     mediaRecorder.ondataavailable = (e) => {
       chunks.push(e.data)
     }
     // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (—Å–º. –Ω–∏–∂–µ)
     mediaRecorder.onstop = mediaRecorderStop
   } catch (e) {
     console.error(e)
     record_img.src = ' img/microphone.png'
   }
 } else {
   // –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –∑–∞–ø—É—â–µ–Ω–∞, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ–µ
   mediaRecorder.stop()
 }
}
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏:

```javascript
function mediaRecorderStop() {
 // –µ—Å–ª–∏ –∏–º–µ–µ—Ç—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∞—è (–Ω–æ–≤–∞—è) –∑–∞–ø–∏—Å—å
 if (audio_box.children[0]?.localName === 'audio') {
   // —É–¥–∞–ª—è–µ–º –µ–µ
   audio_box.children[0].remove()
 }

 // —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç `Blob` —Å –ø–æ–º–æ—â—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞,
 // –ø–µ—Ä–µ–¥–∞–≤–∞—è –µ–º—É `blobParts` –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å —Ç–∏–ø–æ–º —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
 // –æ —Ç–æ–º, —á—Ç–æ —Ç–∞–∫–æ–µ `Blob` –∏ –¥–ª—è —á–µ–≥–æ –æ–Ω –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è
 // –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –∑–¥–µ—Å—å: https://learn.javascript.ru/blob
 audioBlob = new Blob(chunks, { type: 'audio/mp3' })
 // –º–µ—Ç–æ–¥ `createObjectURL()` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ñ–∞–π–ª—ã
 // –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ "–±–µ—Ä–µ—Ç" `Blob` –∏ —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `URL` –¥–ª—è –Ω–µ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `blob:<origin>/<uuid>`
 const src = URL.createObjectURL(audioBlob)

 // —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç `audio`
 const audioEl = createEl({ tag: 'audio', src, controls: true })

 audio_box.append(audioEl)
 // –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å—ã
 toggleClass(record_box, 'hide', 'show')

 // –≤—ã–ø–æ–ª–Ω—è–µ–º –æ—á–∏—Å—Ç–∫—É
 mediaRecorder = null
 chunks = []
}
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:

```javascript
async function saveRecord() {
 // –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ñ–æ—Ä–º–∞—Ç `multipart/form-data`
 const formData = new FormData()
 // –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
 let audioName = prompt('Name?')
 // —Ñ–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
 audioName = audioName ? Date.now() + '-' + audioName : Date.now()
 // –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç - —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å
 // —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –ø–æ–ª—è –≤ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–µ `upload.single()`
 formData.append('audio', audioBlob, audioName)

 try {
   await fetch('/save', {
     method: 'POST',
     body: formData
   })
   console.log('Saved')
   // —Å–±—Ä–æ—Å
   resetRecord()
   // –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
   fetchRecords()
 } catch (e) {
   console.error(e)
 }
}
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ —Å–±—Ä–æ—Å–∞ –∏ —É–¥–∞–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏:

```javascript
function resetRecord() {
 toggleClass(record_box, 'show', 'hide')
 audioBlob = null
}

function removeRecord() {
 if (confirm('Sure?')) {
   resetRecord()
 }
}
```

–î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ–≥–æ DOM-—ç–ª–µ–º–µ–Ω—Ç–∞. –î–ª—è —ç—Ç–æ–≥–æ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤—ã—Å—à–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ `createEl()`:

```javascript
const createRecordEl = (src) => {
 // –ø–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
 const [date, audioName] = src.replace('.mp3', '').split('-')
 // —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
 const audioDate = new Date(+date).toLocaleString()

 // —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
 return createEl({
   className: 'audio_item',
   children: [
     {
       tag: 'audio',
       src,
       // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
       onended: ({ currentTarget }) => {
         // –º–µ–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
         currentTarget.parentElement.querySelector('img').src = 'img/play.png'
       }
     },
     {
       tag: 'button',
       className: 'btn',
       // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (—Å–º. –Ω–∏–∂–µ)
       onclick: playRecord,
       children: [
         {
           tag: 'img',
           src: 'img/play.png'
         }
       ]
     },
     {
       tag: 'p',
       textContent: `${audioDate}${audioName ? ` - ${audioName}` : ''}`
     }
   ]
 })
}
```

–ì–æ—Ç–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

```html
<div class="audio_item">
 <audio src="1632639698031-test1.mp3"></audio>
 <button class="btn">
   <img src="img/play.png">
 </button>
 <p>26.09.2021, 12:01:38 - test1</p>
</div>
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞:

```javascript
async function fetchRecords() {
 try {
   // –ø–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª—ã
   const files = await (await fetch('/records')).json()

   // –æ—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   records_box.innerHTML = ''

   // –µ—Å–ª–∏ –∏–º–µ–µ—Ç—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∞–π–ª
   if (files.length > 0) {
     // —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫
     files.forEach((file) => {
       records_box.append(createRecordEl(file))
     })
   // –µ—Å–ª–∏ —Ñ–∞–π–ª–æ–≤ –Ω–µ—Ç
   } else {
     // –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á—Ç–æ-–Ω–∏–±—É–¥—å –∑–∞–ø–∏—Å–∞—Ç—å
     records_box.append(
       createEl({
         tag: 'p',
         textContent: 'No records. Create one'
       })
     )
   }
 } catch (e) {
   console.error(e)
 }
}
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:

```javascript
function playRecord({ currentTarget: playBtn }) {
 // –Ω–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç `audio`
 const audioEl = playBtn.previousElementSibling

 // –µ—Å–ª–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ –µ—â–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–æ—Å—å –∏–ª–∏ –±—ã–ª–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
 if (audioEl.paused) {
   // –∑–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
   audioEl.play()
   playBtn.firstElementChild.src = 'img/pause.png'
 } else {
   // –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
   audioEl.pause()
   playBtn.firstElementChild.src = 'img/play.png'
 }
}
```

–ù–∞–∫–æ–Ω–µ—Ü, –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∞–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:

```javascript
record_btn.onclick = startRecord
save_btn.onclick = saveRecord
remove_btn.onclick = removeRecord

fetchRecords()
```

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É `yarn start` –∏–ª–∏ `npm start`. –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `public` –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª `style.css`, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ `style.scss`, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (`üöÄ`) –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000`.

<img src="https://habrastorage.org/webt/h3/gi/85/h3gi85vrr98gttuhqzmny1up6w8.png" />
<br />

–ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –≤—ã–¥–∞—á–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–∞–º–º–µ —Ç–∞–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å (–æ–± —ç—Ç–æ–º, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É–µ—Ç –∫—Ä–∞—Å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–∫–∏ –∏ –∑–Ω–∞—á–æ–∫ –≤–∏–¥–µ–æ–∫–∞–º–µ—Ä—ã –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ).

<img src="https://habrastorage.org/webt/xz/yf/an/xzyfanxm4os5stzxjqergzya1zi.png" />
<br />

–ì–æ–≤–æ—Ä–∏–º —á—Ç–æ-–Ω–∏–±—É–¥—å –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ –Ω–∞–∂–∏–º–∞–µ–º "–°—Ç–æ–ø". –ü–æ—è–≤–ª—è–µ—Ç—Å—è –±–ª–æ–∫ —Å –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å—å—é –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –µ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è.

<img src="https://habrastorage.org/webt/8c/zx/sn/8czxsntplxvpy2o8-tla-qmoeyg.png" />
<br />

–ù–∞–∂–∏–º–∞–µ–º "Save" –∏ –≤–≤–æ–¥–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏. –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `uploads` –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.mp3`, –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "Saved", —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

<img src="https://habrastorage.org/webt/vn/un/go/vnungosufttcneuduyhyqgjfc7y.png" />
<br />

The End.
