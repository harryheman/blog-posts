# `React + Express` Screen Recording App :metal:

–û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

- –∑–∞–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ
- —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –∑–∞–ø–∏—Å—å, —Å–æ—Ö—Ä–∞–Ω—è–µ–º–∞—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∏–ª–∏—á–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞, –Ω–æ –≤–µ—Å–∏—Ç—å –º–∞–ª–æ

–°–∫—Ä–∏–Ω—à–æ—Ç:

<img src="https://habrastorage.org/webt/n-/vd/4v/n-vd4vnlbic90ywgmuux1pgdnp0.png" />
<br />

–ö —Å–ª–æ–≤—É, [–∑–¥–µ—Å—å](https://habr.com/ru/company/timeweb/blog/581086/) –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å –æ —Ç–æ–º, –∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∑–≤—É–∫–∞.
<cut />

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

- [`Express.js`](https://expressjs.com/) - `Node.js-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤
- [`React.js`](https://reactjs.org/) - `JavaScript-—Ñ—Ä–µ–º–≤–æ—Ä–∫` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- [`Socket.io`](https://socket.io/) - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ realtime-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –≤–µ–±-—Å–æ–∫–µ—Ç–æ–≤
- [`FFmpeg`](https://www.ffmpeg.org/) - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ

[–ó–¥–µ—Å—å](https://github.com/harryheman/React-Total/blob/main/md/express-api.md) –≤—ã –Ω–∞–π–¥–µ—Ç–µ —à–ø–∞—Ä–≥–∞–ª–∫—É –ø–æ `Express API`, –∞ [–∑–¥–µ—Å—å](https://github.com/harryheman/React-Total/blob/main/md/socket/README.md) - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å `Socket.io`.

–í–º–µ—Å—Ç–æ `React` –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∏–ª–∏ –≤–∞–Ω–∏–ª—å–Ω—ã–π `JS`. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TypeScript`.

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
mkdir screen-record && cd !$

yarn init -yp

yarn add concurrently
```

- —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ
- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º `Node.js-–ø—Ä–æ–µ–∫—Ç`
- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º [`concurrently`](https://www.npmjs.com/package/concurrently)

–û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ `package.json`:

```javascripton
"scripts": {
 "server": "yarn --cwd server dev",
 "client": "yarn --cwd client start",
 "start": "concurrently \"yarn server\" \"yarn client\""
}
```

```bash
mkdir server && cd !$

yarn init -yp

yarn add express socket.io @ffmpeg-installer/ffmpeg fluent-ffmpeg

yarn add -D nodemon
```

- —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ
- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º `Node.js-–ø—Ä–æ–µ–∫—Ç`
- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–æ `ffmpeg` –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –≤ —Ä–∞–∑–¥–µ–ª–µ, –ø–æ—Å–≤—è—â–µ–Ω–Ω–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–µ—Ä–≤–µ—Ä–∞)

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –≤ `package.json`:

```javascripton
"type": "module",
"scripts": {
 "start": "node index.js",
 "dev": "nodemon index.js"
},
```

```bash
cd .. && yarn create react-app client
```

- –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ —Å–æ–∑–¥–∞–µ–º —à–∞–±–ª–æ–Ω `react-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `client`

```bash
cd client

yarn add socket.io-client react-loader-spinner

yarn add -D sass
```

- –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `client`
- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
 - [`socket.io-client`](https://www.npmjs.com/package/socket.io-client): `socket.io` –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
 - [`react-loader-spinner`](https://www.npmjs.com/package/react-loader-spinner): –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ; [–±–æ–ª—å—à–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –ª–æ–∞–¥–µ—Ä–æ–≤ –Ω–∞ —á–∏—Å—Ç–æ–º `CSS`](https://cssloaders.github.io/)
 - [`sass`](https://sass-lang.com/): –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ; –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–µ —Ä–µ—à–µ–Ω–∏–µ `CSS-in-JS` –∏–ª–∏ –æ–±—ã—á–Ω—ã–π `CSS`

–Ø —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏–ª –∏–∑ —à–∞–±–ª–æ–Ω–∞ –≤—Å–µ –ª–∏—à–Ω–µ–µ (–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, `web-vitals` –∏ —Ç.–¥.).

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `package.json` - —ç—Ç–æ –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:

```javascripton
"proxy": "http://localhost:4000",
```

–ù–∞ —ç—Ç–æ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω—ã.

## –ö–ª–∏–µ–Ω—Ç

–í–µ—Å—å –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `scr/App.js`.

```javascript
import { useEffect, useRef, useState } from 'react'
import Loader from 'react-loader-spinner'
import io from 'socket.io-client'
import './App.scss'
```

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ö—É–∫–∏, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, –∫–ª–∏–µ–Ω—Ç–∞ `socket.io` –∏ —Å—Ç–∏–ª–∏.

```javascript
const SERVER_URI = 'http://localhost:4000'

let mediaRecorder = null
let dataChunks = []
```

–°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

- –¥–ª—è –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
- —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ [`MediaRecorder`](https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder). `MediaRecorder` - —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π [`MediaStream Recording API`](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API), –¥–ª—è –∑–∞–ø–∏—Å–∏ –º–µ–¥–∏–∞
- —á–∞—Å—Ç–µ–π –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```javascript
function App() {
 // TODO
}

export default App
```

<br />

```javascript
const username = useRef(`User_${Date.now().toString().slice(-4)}`)
const socketRef = useRef(io(SERVER_URI))
const videoRef = useRef()
const linkRef = useRef()
```

- –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `User_1234`) - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –±—É–¥–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å—Å—è –∏–∑ –æ–±—ä–µ–∫—Ç–∞ `user`, —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, `const { user } = useAuthContext(); const { username } = user`
- –≤—ã–∑–æ–≤ `io(url, options)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–æ–∫–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞. –ù–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞. –° –ø–æ–ª–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ–∂–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è [–∑–¥–µ—Å—å](https://socket.io/docs/v4/client-options/)
- –Ω–∞–º —Ç–∞–∫–∂–µ –Ω—É–∂–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ `DOM-—ç–ª–µ–º–µ–Ω—Ç—ã` `video` –∏ `a` –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–ø–∏—Å–∏ –∏ –µ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ö—É–∫ `useRef` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –º–µ–∂–¥—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞–º–∏.

```javascript
const [screenStream, setScreenStream] = useState()
const [voiceStream, setVoiceStream] = useState()
const [recording, setRecording] = useState(false)
const [loading, setLoading] = useState(true)
```

- `screenStream` - –ø–æ—Ç–æ–∫ –≤–∏–¥–µ–æ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
- `voiceStream` - –ø–æ—Ç–æ–∫ –∞—É–¥–∏–æ –∏–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
- `recording` - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–ø–∏—Å–∏
- `loading` - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

–ü–µ—Ä–≤–æ–µ, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ - —ç—Ç–æ —É–≤–µ–¥–æ–º–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–æ–±—â–∏–≤ –µ–º—É –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```javascript
useEffect(() => {
 socketRef.current.emit('user:connected', username.current)
}, [])
```

–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `socket.emit(type, data)`, –≥–¥–µ `type` - —Å—Ç—Ä–æ–∫–∞, –æ–±–æ–∑–Ω–∞—á–∞—é—â–∞—è —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è, –∞ `data` - –¥–∞–Ω–Ω—ã–µ. –î–∞–Ω–Ω—ã–º–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫ –ø—Ä–∏–º–∏—Ç–∏–≤—ã, —Ç–∞–∫ –∏ –æ–±—ä–µ–∫—Ç—ã. –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `socket.on(type, callback)`, –≥–¥–µ `type` - —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è, –∞ `callback` - —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è –¥–∞–Ω–Ω—ã–µ, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é `socket.emit`.

–î–∞–ª–µ–µ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω (–ø–æ–ª—É—á–∏—Ç—å –ø–æ—Ç–æ–∫ –≤–∏–¥–µ–æ–¥–∞–Ω–Ω—ã—Ö):

```javascript
useEffect(() => {
 ;(async () => {
   // –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
   if (navigator.mediaDevices.getDisplayMedia) {
     try {
       // –ø–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫
       const _screenStream = await navigator.mediaDevices.getDisplayMedia({
         video: true
       })
       // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
       setScreenStream(_screenStream)
     } catch (e) {
       console.error('*** getDisplayMedia', e)
       setLoading(false)
     }
   } else {
     console.warn('*** getDisplayMedia not supported')
     setLoading(false)
   }
 })()
}, [])
```

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∏–¥–µ–æ–¥–∞–Ω–Ω—ã—Ö –∏–∑ –∑–∞—Ö–≤–∞—Ç–∞ —ç–∫—Ä–∞–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ [`getDisplayMedia()`](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getDisplayMedia), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º [`MediaDevices`](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices), –≤—Ö–æ–¥—è—â–∏–º –≤ —Å–æ—Å—Ç–∞–≤ [`Navigator`](https://developer.mozilla.org/en-US/docs/Web/API/Navigator).

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ [–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏, —á—Ç–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–∫–æ–ª–æ 40% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](https://caniuse.com/mdn-api_mediadevices_getdisplaymedia), –Ω–æ —ç—Ç–æ –≤—Å–µ –∂–µ –ª—É—á—à–µ, —á–µ–º –Ω–∏—á–µ–≥–æ.

–°–ª–µ–¥—É–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ `getDisplayMedia` —Ç–∞–∫–∂–µ —É–º–µ–µ—Ç –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∞—É–¥–∏–æ–¥–∞–Ω–Ω—ã–µ, –Ω–æ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —ç—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å [–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ `Edge` –∏ `Chrome`](https://caniuse.com/mdn-api_mediadevices_getdisplaymedia_audio-capture-support), –ø–æ—ç—Ç–æ–º—É –º—ã –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –¥—Ä—É–≥–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

_–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ_: Safari —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –≤—ã—Ä–∞–∑–∏–ª –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –Ω–∞ –∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞. –î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –¥–∞–Ω–Ω—ã–π –±–ª–æ–∫ –∫–æ–¥–∞ –º–æ–∂–Ω–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏—é `startRecording` (—Å–º. –Ω–∏–∂–µ).

–ü–æ–ª—É—á–∞–µ–º –∞—É–¥–∏–æ–¥–∞–Ω–Ω—ã–µ –∏–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```javascript
useEffect(() => {
 ;(async () => {
   // –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
   if (navigator.mediaDevices.getUserMedia) {
     // —Å–Ω–∞—á–∞–ª–∞ –º—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫
     if (screenStream) {
       try {
         // –ø–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫
         const _voiceStream = await navigator.mediaDevices.getUserMedia({
           audio: true
         })
         // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
         setVoiceStream(_voiceStream)
       } catch (e) {
         console.error('*** getUserMedia', e)
         // —Å–º. –Ω–∏–∂–µ
         setVoiceStream('unavailable')
       } finally {
         setLoading(false)
       }
     }
   } else {
     console.warn('*** getUserMedia not supported')
     setLoading(false)
   }
 })()
}, [screenStream])
```

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞—É–¥–∏–æ-–ø–æ—Ç–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ [`getUserMedia`](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia). –° –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ [–≤—Å–µ –Ω–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ](https://caniuse.com/mdn-api_mediadevices_getusermedia).

–ù–µ –∑–Ω–∞—é —Ç–æ—á–Ω–æ, —Å —á–µ–º —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ, –Ω–æ –µ—Å–ª–∏ –º—ã –ø–æ–ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Ç–æ–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, —Ç–æ –ø–æ–ª—É—á–∏–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫, –∞ –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –æ—à–∏–±–∫–æ–π `Permission denied`. –ü–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ, —Ç–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –≤ `Chrome`.

–ú—ã –≥–æ—Ç–æ–≤—ã –ø–∏—Å–∞—Ç—å —ç–∫—Ä–∞–Ω –±–µ–∑ –∑–≤—É–∫–∞, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–∏, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫–∞ (–≤–∫–ª—é—á–∞—è –æ—Ç–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞), –º—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º `voiceStream` –≤ –∑–Ω–∞—á–µ–Ω–∏–µ `unavailable`.

–¢–∞–∫–∂–µ _–æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_ –Ω–∞ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫—É `setLoading(false)`. –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.

–ì–ª—è–Ω–µ–º –Ω–∞ —Ä–∞–∑–º–µ—Ç–∫—É:

```javascript
return (
 <>
   <h1>Screen Recording App</h1>
   <video controls ref={videoRef}></video>
   <a ref={linkRef}>Download</a>
   <button onClick={onClick} disabled={!voiceStream}>
     {!recording ? 'Start' : 'Stop'}
   </button>
 </>
)
```

–ù–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ:

- —ç–ª–µ–º–µ–Ω—Ç `video` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–ø–∏—Å–∏
- —ç–ª–µ–º–µ–Ω—Ç `a` –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏

–ú–µ—Ç–æ–¥ `onClick` –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```javascript
const onClick = () => {
 if (!recording) {
   startRecording()
 } else {
   if (mediaRecorder) {
     mediaRecorder.stop()
   }
 }
}
```

–û–ø–µ—Ä–∞—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `recording`.

```javascript
function startRecording() {
 if (screenStream && voiceStream && !mediaRecorder) {
   // TODO
 }
}
```

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `startRecording` —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `MediaRecorder`.

```javascript
// –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
setRecording(true)

// —É–¥–∞–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã
videoRef.current.removeAttribute('src')
linkRef.current.removeAttribute('href')
linkRef.current.removeAttribute('download')
```

–§–æ—Ä–º–∏—Ä—É–µ–º –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫:

```javascript
let mediaStream
if (voiceStream === 'unavailable') {
 mediaStream = screenStream
} else {
 mediaStream = new MediaStream([
   ...screenStream.getVideoTracks(),
   ...voiceStream.getAudioTracks()
 ])
}
```

–°–æ—Å—Ç–∞–≤ –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫–∞. –ï—Å–ª–∏ –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –º–µ–¥–∏–∞–ø–æ—Ç–æ–∫ –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞. –ò–Ω–∞—á–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –∏–∑ –≤–∏–¥–µ–æ—Ç—Ä–µ–∫–æ–≤ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ –∏ –∞—É–¥–∏–æ—Ç—Ä–µ–∫–æ–≤ –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫–∞. –î–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å [`MediaStream`](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream). –° –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π [–≤—Å–µ —Ö–æ—Ä–æ—à–æ](https://caniuse.com/mdn-api_mediastream).

–°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–∞–∫–∂–µ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤:

```javascript
const audioTracks = voiceStream.getAudioTracks()
audioTracks.forEach(track => {
 screenStream.addTrack(track)
})
mediaStream = screenStream
```

<br />

```javascript
mediaRecorder = new MediaRecorder(mediaStream)
mediaRecorder.ondataavailable = ({ data }) => {
 dataChunks.push(data)
 socketRef.current.emit('screenData:start', {
   username: username.current,
   data
 })
}
mediaRecorder.onstop = stopRecording
mediaRecorder.start(250)
```

–°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä `MediaRecorder`.

–ú–µ—Ç–æ–¥ `start` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—Å. –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `dataavailable`. –î–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤ —Å–≤–æ–π—Å—Ç–≤–µ `data`.

–ú—ã –ø–æ–º–µ—â–∞–µ–º —á–∞—Å—Ç–∏ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –º–∞—Å—Å–∏–≤ `dataChunks` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–º–æ—â—å—é —Å–æ–∫–µ—Ç–∞. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã –¥–µ–ª–∞–µ–º —ç—Ç–æ 4 —Ä–∞–∑–∞ –≤ —Å–µ–∫—É–Ω–¥—É.

–ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é –∑–∞–ø–∏—Å–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `stopRecording`:

```javascript
function stopRecording() {
 // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
 setRecording(false)

 // —Å–æ–æ–±—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä—É –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
 socketRef.current.emit('screenData:end', username.current)

 // –æ–± —ç—Ç–æ–º —Ö–æ—Ä–æ—à–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –∑–¥–µ—Å—å: https://learn.javascript.ru/blob
 // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
 // https://developer.mozilla.org/en-US/docs/Web/API/Blob
 // https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL
 const videoBlob = new Blob(dataChunks, {
   type: 'video/webm'
 })
 const videoSrc = URL.createObjectURL(videoBlob)

 // –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ
 videoRef.current.src = videoSrc
 // —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
 linkRef.current.href = videoSrc
 // –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∞—á–∏–≤–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
 linkRef.current.download = `${Date.now()}-${username.current}.webm`

 // –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–±—Ä–æ—Å
 mediaRecorder = null
 dataChunks = []
}
```

–ù–∞ —ç—Ç–æ–º —Å –∫–ª–∏–µ–Ω—Ç–æ–º –º—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏.

## –°–µ—Ä–≤–µ—Ä

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `server`):

```
- socket_io
 - onConnection.js - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- utils
 - saveData.js - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
- video - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∑–∞–ø–∏—Å–µ–π
- index.js - –∫–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞
- ...
```

–ù–∞—á–Ω–µ–º —Å —Ñ–∞–π–ª–∞, —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ –∫–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ (`index.js`):

```javascript
import express from 'express'
import http from 'http'
import { Server } from 'socket.io'
import { onConnection } from './socket_io/onConnection.js'
```

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

```javascript
const app = express()
const server = http.createServer(app)
const io = new Server(server, {
 cors: {
   origin: 'http://localhost:3000'
 }
})
```

–°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä—ã `express-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è`, —Å–µ—Ä–≤–µ—Ä–∞ –∏ `socket.io`. _–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫—É `cors`. –î–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π.

```javascript
io.on('connection', onConnection)

server.listen(4000, () => {
 console.log('Server ready üöÄ ')
})
```

–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É `4000`.

_–§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (`socket_io/onConnection.js`)_

```javascript
import { saveData } from '../utils/saveData.js'

const socketByUser = {}
const dataChunks = {}
```

- –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
- —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
 - –ø–æ–∏—Å–∫–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É `–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–∫–µ—Ç–∞ - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è`
 - –¥–ª—è —á–∞—Å—Ç–µ–π –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. _–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_ –Ω–∞ —Ç–æ, —á—Ç–æ –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞, –≥–¥–µ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –º–∞—Å—Å–∏–≤, –∑–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ä–µ–∫—Ç

```javascript
export const onConnection = (socket) => {
 // TODO
}
```

–§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–∫–µ—Ç.

```javascript
socket.on('user:connected', (username) => {
 if (!socketByUser[socket.id]) {
   socketByUser[socket.id] = username
 }
})
```

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∑–∞–ø–∏—Å–∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–æ–∏—Å–∫–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É.

```javascript
socket.on('screenData:start', ({ data, username }) => {
 if (dataChunks[username]) {
   dataChunks[username].push(data)
 } else {
   dataChunks[username] = [data]
 }
})
```

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ —á–∞—Å—Ç–µ–π –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. `dataChunks` - —ç—Ç–æ —Ç–∞–∫–∂–µ –ø–æ–∏—Å–∫–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö`.

```javascript
socket.on('screenData:end', (username) => {
 if (dataChunks[username] && dataChunks[username].length) {
   // –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö,
   // –ø–µ—Ä–µ–¥–∞–≤–∞—è –µ–π –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   saveData(dataChunks[username], username)
   dataChunks[username] = []
 }
})
```

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏.

```javascript
socket.on('disconnect', () => {
 const username = socketByUser[socket.id]
 if (dataChunks[username] && dataChunks[username].length) {
   saveData(dataChunks[username], username)
   dataChunks[username] = []
 }
})
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å–ª—É—á–∞–π –∑–∞–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ - –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å–æ–±—ã—Ç–∏–µ `screenData:end` –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–µ –±—É–¥–µ—Ç. –í —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ –º—ã –ø–æ—Ç–µ—Ä—è–µ–º `250 –º—Å` –≤–∏–¥–µ–æ (`mediaRecorder.start(250)`).

_–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ (`utils/saveData.js`)_

```javascript
import { Blob, Buffer } from 'buffer'
import { mkdir, open, unlink, writeFile } from 'fs/promises'
import { join, dirname } from 'path'
import { fileURLToPath } from 'url'
```

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —É—Ç–∏–ª–∏—Ç—ã –∏–∑ `Node.js`. _–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_: `Buffer` –ø–æ—è–≤–∏–ª—Å—è –≤ `Node.js` –Ω–µ–¥–∞–≤–Ω–æ –∏ —è–≤–ª—è–µ—Ç—Å—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º. –í–æ–∑–º–æ–∂–Ω–æ, –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å `Node.js` (–∫–∞–∫ —ç—Ç–æ –ø—Ä–∏—à–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å –º–Ω–µ –Ω–∞ –¥–æ–º–∞—à–Ω–µ–π –º–∞—à–∏–Ω–µ), –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —á–µ–º-—Ç–æ –≤—Ä–æ–¥–µ [`node-blob`](https://www.npmjs.com/package/node-blob) –∏–ª–∏ –Ω–∞–π—Ç–∏ –¥—Ä—É–≥–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞.

```javascript
import { path } from '@ffmpeg-installer/ffmpeg'
import ffmpeg from 'fluent-ffmpeg'
ffmpeg.setFfmpegPath(path)
```

- [`fluent-ffmpeg`](https://www.npmjs.com/package/fluent-ffmpeg) - –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è `ffmpeg`
- [`'@ffmpeg-installer/ffmpeg`](https://www.npmjs.com/package/@ffmpeg-installer/ffmpeg) - –¥–ª—è —Ä–∞–±–æ—Ç—ã `fluent-ffmpeg` —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ `ffmpeg`. –î–∞–Ω–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –∏ –¥–µ–ª–∞–µ—Ç, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –ø—É—Ç—å –∫ `ffmpeg`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `fluent-ffmpeg`

```javascript
// –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
const __dirname = dirname(fileURLToPath(import.meta.url))

// —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
export const saveData = async (data, username) => {
 // TODO
}
```

```javascript
// –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∑–∞–ø–∏—Å–µ–π
const videoPath = join(__dirname, '../video')

// –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π - –Ω–∞–ø—Ä–∏–º–µ—Ä, 21_11_2021
const dirName = new Date().toLocaleDateString().replace(/\./g, '_')
// –ø—É—Ç—å –∫ —ç—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
const dirPath = `${videoPath}/${dirName}`

// –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞, –≤–∫–ª—é—á–∞—é—â–µ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const fileName = `${Date.now()}-${username}.webm`
// –ø—É—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É
const tempFilePath = `${dirPath}/temp-${fileName}`
// –ø—É—Ç—å –∫ –∏—Ç–æ–≥–æ–≤–æ–º—É —Ñ–∞–π–ª—É
const finalFilePath = `${dirPath}/${fileName}`
```

<br />

```javascript
let fileHandle
try {
 fileHandle = await open(dirPath)
} catch {
 await mkdir(dirPath)
} finally {
 if (fileHandle) {
   fileHandle.close()
 }
}
```

–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π (–æ–¥–∏–Ω —Ä–∞–∑).

```javascript
try {
 // TODO
} catch {
 console.log('*** saveData', e)
}
```

<br />

```javascript
const videoBlob = new Blob(data, {
 type: 'video/webm'
})
const videoBuffer = Buffer.from(await videoBlob.arrayBuffer())

await writeFile(tempFilePath, videoBuffer)
```

–°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–∏–¥–µ–æ—Ñ–∞–π–ª. –ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –Ω–∞—à —Ñ–∞–π–ª –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç [`WebM`](https://ru.wikipedia.org/wiki/WebM), –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –∫–ª–∞—Å—Å–Ω—ã–π (—è –∏–º–µ—é –≤–≤–∏–¥—É —Ñ–æ—Ä–º–∞—Ç).

```javascript
ffmpeg(tempFilePath)
 .outputOptions([
   '-c:v libvpx-vp9',
   '-c:a copy',
   '-crf 35',
   '-b:v 0',
   '-vf scale=1280:720'
 ])
 .on('end', async () => {
   await unlink(tempFilePath)
   console.log(`*** File ${fileName} created`)
 })
 .save(finalFilePath, dirPath)
```

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é `ffmpeg`:

- –ø–µ—Ä–µ–¥–∞–µ–º `ffmpeg` –ø—É—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É
- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ (—Å–º. –Ω–∏–∂–µ)
- –ø–µ—Ä–µ–¥–∞–µ–º –º–µ—Ç–æ–¥—É `save` –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–¥–ª—è —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∑–∞–≤–µ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é)
- —É–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

–ö —Å–ª–æ–≤—É, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è + –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–∏–¥–µ–æ- –∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ –≤ –æ–¥–∏–Ω –≤–∏–¥–µ–æ—Ñ–∞–π–ª —Ñ–æ—Ä–º–∞—Ç–∞ `WebM` —Å –ø–æ–º–æ—â—å—é `CLI` –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```bash
ffmpeg -i video.webm -i audio.webm -c:v libvpx-vp9 -c:a copy -crf 35 -b:v 0 -vf scale=1280:720 -shortest merged.webm
```

–ù–∞—Å—Ç—Ä–æ–π–∫–∏:

- `-c` - —ç—Ç–æ –∫–æ–¥–µ–∫
- `-c:v` - [–∫–æ–¥–µ–∫ –¥–ª—è –≤–∏–¥–µ–æ](https://ru.wikipedia.org/wiki/%D0%92%D0%B8%D0%B4%D0%B5%D0%BE%D0%BA%D0%BE%D0%B4%D0%B5%D0%BA)
- `-c:a` - [–∫–æ–¥–µ–∫ –¥–ª—è –∞—É–¥–∏–æ](https://ru.wikipedia.org/wiki/%D0%90%D1%83%D0%B4%D0%B8%D0%BE%D0%BA%D0%BE%D0%B4%D0%B5%D0%BA)

–í –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–µ–∫–∞ –¥–ª—è –≤–∏–¥–µ–æ –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º `libvpx-vp9` ([`VP9`](https://ru.wikipedia.org/wiki/VP9)). –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ (–µ—Å–ª–∏ —è –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∞ `WebM` —Ç—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –≤–∏–¥–µ–æ —Å–æ–¥–µ—Ä–∂–∞–ª–æ—Å—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ [`VP8`](https://ru.wikipedia.org/wiki/VP8) –∏–ª–∏ `VP9`, –∞ –∞—É–¥–∏–æ - –≤ [`Opus`](https://ru.wikipedia.org/wiki/Opus_(%D0%BA%D0%BE%D0%B4%D0%B5%D0%BA)) –∏–ª–∏ [`Vorbis`](https://ru.wikipedia.org/wiki/Vorbis). –ê—É–¥–∏–æ-–¥–æ—Ä–æ–∂–∫—É –º—ã –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ–º —É–∫–∞–∑—ã–≤–∞—è `copy` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–µ–∫–∞. –ù–µ —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –Ω–∞–º –∑–¥–µ—Å—å —ç—Ç–æ –Ω—É–∂–Ω–æ. –≠—Ç–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –º–æ–∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –ø–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –∏ —Å–ª–∏—è–Ω–∏—é –≤–∏–¥–µ–æ- –∏ –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫–æ–≤.

_–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ_: –≤ Safari –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∫–æ–¥–µ–∫–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞.

- `-vf scale=1280:720` - —ç—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, —á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –∏ —Ö—É–∂–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ (—ç—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ)
- `-crf 35 -b:v 0` - —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —è –≤–∑—è–ª [–æ—Ç—Å—é–¥–∞](https://trac.ffmpeg.org/wiki/Encode/VP9)(—Å–º. —Ä–∞–∑–¥–µ–ª `Constant Quality`) –í–æ—Ç –µ—â–µ –æ–¥–∏–Ω [–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã](http://wiki.webmproject.org/ffmpeg/vp9-encoding-guide). –í –Ω–∞–∑–≤–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ –≤ –¥–≤–∞ –ø—Ä–æ—Ö–æ–¥–∞ (`pass`), –Ω–æ —è —Å—Ç—Ä–µ–º–∏–ª—Å—è –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏ –º–µ–Ω—è —É—Å—Ç—Ä–∞–∏–≤–∞–ª–æ –Ω–µ–±–æ–ª—å—à–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

`crf` - —ç—Ç–æ [–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏](https://ru.wikipedia.org/wiki/Constant_Rate_Factor)(Constant Rate Factor), –∞ `b:v` - [–±–∏—Ç—Ä–µ–π—Ç](https://ru.wikipedia.org/wiki/%D0%91%D0%B8%D1%82%D1%80%D0%B5%D0%B9%D1%82) –≤–∏–¥–µ–æ.

–° –ø–æ–ª–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ–∂–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è [–∑–¥–µ—Å—å](https://www.ffmpeg.org/ffmpeg.html#Options).

–°–∫–æ—Ä–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–º–∏ –º—ã —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ–º. –í —Å—Ä–µ–¥–Ω–µ–º –≤—Ä–µ–º—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ä–∞–≤–Ω—è–µ—Ç—Å—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 3 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞. –ü—Ä–∏ —ç—Ç–æ–º –∫–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ —Å—Ç—Ä–∞–¥–∞–µ—Ç –Ω–µ —Å–∏–ª—å–Ω–æ. –Ø –Ω–µ–±–æ–ª—å—à–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ä–∞–±–æ—Ç–µ —Å –≤–∏–¥–µ–æ, —Å `ffmpeg` –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–¥–∞–≤–Ω–æ, –ø–æ—ç—Ç–æ–º—É –±—É–¥—É —Ä–∞–¥ –ª—é–±—ã–º –∑–∞–º–µ—á–∞–Ω–∏—è–º –Ω–∞ —ç—Ç–æ—Ç —Å—á–µ—Ç.

–ù–∞ —ç—Ç–æ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º –º—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–∞—Ö–æ–¥—è—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞, –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É `yarn start`.

–ü–æ –∞–¥—Ä–µ—Å—É `http://localhost:4000` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∞ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000` - —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞. –í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞.

–°–Ω–∞—á–∞–ª–∞ –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞.

<img src="https://habrastorage.org/webt/m2/vx/cu/m2vxcuxumuetdfe989v-_so8h0w.png" />
<br />

–ó–∞—Ç–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∑–∞—Ö–≤–∞—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

<img src="https://habrastorage.org/webt/9q/zs/68/9qzs68batai7umpzjfpkcvwxkty.png" />
<br />

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –µ–º—É —ç—Ç–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è. –ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∑–∞—Ö–≤–∞—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –∞ –Ω–∞ –∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞ - –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

<img src="https://habrastorage.org/webt/hv/he/pd/hvhepdfzj8g_ozfr2gyeqnytg88.png" />
<br />

–ù–∞–∂–∏–º–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É `Start`. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å.

–ù–∞–∂–∏–º–∞–µ–º –Ω–∞ `Stop`. –ó–∞–ø–∏—Å—å –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è. –£ –≤–∏–¥–µ–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫, —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π.

<img src="https://habrastorage.org/webt/n-/vd/4v/n-vd4vnlbic90ywgmuux1pgdnp0.png" />
<br />

–°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª. –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å. –õ—é–±—É–µ–º—Å—è —Å–≤–æ–∏–º —ç–∫—Ä–∞–Ω–æ–º –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–µ–º—Å—è —Å–≤–æ–∏–º –≥–æ–ª–æ—Å–æ–º üòä

–ó–∞–≥–ª—è–¥—ã–≤–∞–µ–º –≤ `server/video`, –Ω–∞—Ö–æ–¥–∏–º —Ç–∞–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, `21_11_2021`, –∞ –≤ –Ω–µ–π —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, `1637480942425-User_0711`. –°—Ä–∞–≤–Ω–∏—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∏ –∫–∞—á–µ—Å—Ç–≤–∞.

–ü–æ–∑–¥—Ä–∞–≤–ª—è—é, —Ç–µ–ø–µ—Ä—å –≤—ã —É–º–µ–µ—Ç–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —ç–∫—Ä–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

The End.
