# React + Express + Socket.io Chat App :metal:

Let's rock!

–í –¥–∞–Ω–Ω–æ–º —Ç—É—Ç–æ—Ä–∏–∞–ª–µ —è –ø–æ–∫–∞–∂—É –≤–∞–º, –∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º [`Socket.io`](https://socket.io/), [`Express`](https://expressjs.com/ru/) –∏ [`React`](https://ru.reactjs.org/) —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Ä–∞–±–æ—Ç–µ —Å –º–µ–¥–∏–∞.

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º:

- –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–µ –∏–º—è;
- –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ;
- –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–º—è –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–∏–º–∏—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏);
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ [–≤–µ–±-—Å–æ–∫–µ—Ç—ã](https://ru.wikipedia.org/wiki/WebSocket) –∏ –≤—Ö–æ–¥ –≤ –∫–æ–º–Ω–∞—Ç—É `main_room` (–ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥—Ä—É–≥–∏—Ö –∫–æ–º–Ω–∞—Ç);
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏;
- —Ç–∏–ø–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–µ–∫—Å—Ç, –∞—É–¥–∏–æ, –≤–∏–¥–µ–æ –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ;
- –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ;
- –ø—É—Ç—å –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ñ–∞–π–ª—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ;
- —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö;
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ—Å–æ–æ–±—â–µ–Ω–∏—è;
- –ø–æ—Å–ª–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –∏ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ –∏–ª–∏ –≤–∏–¥–µ–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–µ–≤—å—é —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞;
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —ç–º–æ–¥–∑–∏;
- —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –æ–∑–≤—É—á–∏–≤–∞—Ç—å—Å—è;
- –∏ —Ç.–¥.

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º `Node.js-–ø—Ä–æ–µ–∫—Ç`:

```bash
mkdir chat-app
cd chat-app

yarn init -yp
# or
npm init -y
```

–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ —à–∞–±–ª–æ–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é [`Create React App`](https://create-react-app.dev/):

```bash
mkdir server

yarn create react-app client
# or
npx create-react-app client
```

–ù–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–≤–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–∞–º–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞), –ø–æ—ç—Ç–æ–º—É —É—Å—Ç–∞–Ω–æ–≤–∏–º [`concurrently`](https://www.npmjs.com/package/concurrently) - —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–∞–Ω–¥, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ `package.json`:

```bash
yarn add concurrently
# or
npm i concurrently
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ `package.json`:

```javascripton
"scripts": {
  "dev:client": "yarn --cwd client start",
  "dev:server": "yarn --cwd server dev",
  "dev": "concurrently \"yarn dev:client\" \"yarn dev:server\""
}
```

–ò–ª–∏, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `npm`:

```javascripton
"scripts": {
  "dev:client": "npm run start --prefix client",
  "dev:server": "npm run dev --prefix server",
  "dev": "concurrently \"npm run dev:client\" \"npm run dev:server\""
}
```

–í –∫–∞—á–µ—Å—Ç–≤–µ –ë–î –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [`MongoDb Atlas Database`](https://www.mongodb.com/atlas/database).

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ, —Å–æ–∑–¥–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç –∏ –∫–ª–∞—Å—Ç–µ—Ä –∏ –ø–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∞ `mongodb+srv://<user>:<password>@cluster0.f7292.mongodb.net/<database>?retryWrites=true&w=majority`*, –≥–¥–µ `<user>`, `<password>` –∏ `<database>` - –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —É–∫–∞–∑–∞–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∫–ª–∞—Å—Ç–µ—Ä–∞.

* –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –ë–î –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–∂–∞—Ç—å `Connect` —Ä—è–¥–æ–º —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∞ (`Cluster0`) –∏ –∑–∞—Ç–µ–º `Connect your application`.
* –ï—Å–ª–∏ —É –≤–∞—Å, –∫–∞–∫ –∏ —É –º–µ–Ω—è, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π [`IP`](https://ru.wikipedia.org/wiki/IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81), –≤–æ –≤–∫–ª–∞–¥–∫–µ `Network Access` —Ä–∞–∑–¥–µ–ª–∞ `Security` –Ω–∞–¥–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å `0.0.0.0/0`

<img src="https://habrastorage.org/webt/dt/56/vy/dt56vykt9oi9wwb6gpmsweqyfqu.png" />
<br />

<img src="https://habrastorage.org/webt/zn/ay/se/znayseg_h13wwcq3gbzofxkx3-a.png" />
<br />

–ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.

## –°–µ—Ä–≤–µ—Ä

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `server` –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
cd server

# –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
yarn add express socket.io mongoose cors multer
# or
npm i ...

# –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
yarn add -D nodemon
# or
npm i -D nodemon
```

- `express` - `Node.js-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤;
- `socket.io` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –æ–±–ª–µ–≥—á–∞—é—â–∞—è —Ä–∞–±–æ—Ç—É —Å –≤–µ–±-—Å–æ–∫–µ—Ç–∞–º–∏;
- [`mongoose`](https://mongoosejs.com/) - [ORM](https://ru.wikipedia.org/wiki/ORM) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `MongoDB`;
- [`cors`](https://www.npmjs.com/package/cors) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å [CORS](https://developer.mozilla.org/ru/docs/Web/HTTP/CORS);
- [`multer`](https://www.npmjs.com/package/multer) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ (–ø–∞—Ä—Å–∏–Ω–≥–∞) –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ [`multipart/form-data`](https://ru.wikipedia.org/wiki/Multipart/form-data) (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ);
- [`nodemon`](https://www.npmjs.com/package/nodemon) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–º–æ–¥—É–ª—å) –∏ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ñ–∞–π–ª–µ `package.json`:

```javascripton
"type": "module",
"scripts": {
  "dev": "nodemon"
}
```

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `server` –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π:

```
- files - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- models
  - message.model.js - –º–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è `Mongoose`
- socket_io
  - handlers
    - message.handlers.js - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
    - user.handler.js - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - onConnection.js - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- utils
  - file.js - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
  - onError.js - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
  - upload.js - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- config.js - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–º–µ–µ—Ç—Å—è —Ñ–∞–π–ª `config.example.js` —Å –ø—Ä–∏–º–µ—Ä–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫)
- index.js - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ `config.js` (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ `.gitignore`):

```javascript
// —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
export const ALLOWED_ORIGIN = 'http://localhost:3000'
// –∞–¥—Ä–µ—Å –ë–î
export const MONGODB_URI =
  'mongodb+srv://<user>:<password>@cluster0.f7292.mongodb.net/<database>?retryWrites=true&w=majority'
```

–û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–¥–µ–ª—å –≤ —Ñ–∞–π–ª–µ `models/message.model.js`:

```javascript
import mongoose from 'mongoose'

const { Schema, model } = mongoose

const messageSchema = new Schema(
  {
    messageId: {
      type: String,
      required: true,
      unique: true
    },
    messageType: {
      type: String,
      required: true
    },
    textOrPathToFile: {
      type: String,
      required: true
    },
    roomId: {
      type: String,
      required: true
    },
    userId: {
      type: String,
      required: true
    },
    userName: {
      type: String,
      required: true
    }
  },
  {
    timestamps: true
  }
)

export default model('Message', messageSchema)
```

–ö–∞–∂–¥–æ–µ –Ω–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

- `messageId` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è;
- `messageType` - —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è;
- `textOrPathToFile` - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É;
- `roomId` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã;
- `userId` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
- `userName` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
- `createdAt`, `updatedAt` - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ (`timestamps: true`).

–ö—Ä–∞—Ç–∫–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —É—Ç–∏–ª–∏—Ç—ã (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `utils`).

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ (`onError.js`):

```javascript
export default function onError(err, req, res, next) {
  console.log(err)

  // –µ—Å–ª–∏ –∏–º–µ–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç –æ—Ç–≤–µ—Ç–∞
  if (res) {
    // —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏
    const status = err.status || err.statusCode || 500
    // —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    const message = err.message || 'Something went wrong. Try again later'
    res.status(status).json({ message })
  }
}
```

–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ (`file.js`):

```javascript
import { unlink } from 'fs/promises'
import { dirname, join } from 'path'
import { fileURLToPath } from 'url'
import onError from './onError.js'

// –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
const _dirname = dirname(fileURLToPath(import.meta.url))

// –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏
const fileDir = join(_dirname, '../files')

// —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É
export const getFilePath = (filePath) => join(fileDir, filePath)

// —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞
export const removeFile = async (filePath) => {
  try {
    await unlink(join(fileDir, filePath))
  } catch (e) {
    onError(e)
  }
}
```

–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (`upload.js`):

```javascript
import { existsSync, mkdirSync } from 'fs'
import multer from 'multer'
import { dirname, join } from 'path'
import { fileURLToPath } from 'url'

// –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
const _dirname = dirname(fileURLToPath(import.meta.url))

const upload = multer({
  storage: multer.diskStorage({
    // –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–æ–≤
    destination: async (req, _, cb) => {
      // –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã –∏–∑ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Room-Id`
      const roomId = req.headers['x-room-id']
      // —Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ –∫–æ–º–Ω–∞—Ç–∞–º
      // –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã
      const dirPath = join(_dirname, '../files', roomId)

      // —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏
      if (!existsSync(dirPath)) {
        mkdirSync(dirPath, { recursive: true })
      }

      cb(null, dirPath)
    },
    filename: (_, file, cb) => {
      // –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏
      // –¥–æ–±–∞–≤–ª—è–µ–º –∫ –Ω–∞–∑–≤–∞–Ω–∏—é –≤—Ä–µ–º—è —Å –Ω–∞—á–∞–ª–∞ —ç–ø–æ—Ö–∏ –∏ –¥–µ—Ñ–∏—Å
      const fileName = `${Date.now()}-${file.originalname}`

      cb(null, fileName)
    }
  })
})

export default upload
```

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞ (`index.js`).

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –∏ –≤—Å—è:

```javascript
import cors from 'cors'
import express from 'express'
import { createServer } from 'http'
import mongoose from 'mongoose'
import { Server } from 'socket.io'
import { ALLOWED_ORIGIN, MONGODB_URI } from './config.js'
import onConnection from './socket_io/onConnection.js'
import { getFilePath } from './utils/file.js'
import onError from './utils/onError.js'
import upload from './utils/upload.js'
```

–°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä `Express-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è` –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `CORS` –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ `JSON`:

```javascript
const app = express()

app.use(
  cors({
    origin: ALLOWED_ORIGIN
  })
)
app.use(express.json())
```

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤:

```javascript
app.use('/upload', upload.single('file'), (req, res) => {
  if (!req.file) return res.sendStatus(400)

  // —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
  const relativeFilePath = req.file.path
    .replace(/\\/g, '/')
    .split('server/files')[1]

  // –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ
  res.status(201).json(relativeFilePath)
})
```

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:

```javascript
app.use('/files', (req, res) => {
  // —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
  const filePath = getFilePath(req.url)

  // –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–∞–π–ª –ø–æ —ç—Ç–æ–º—É –ø—É—Ç–∏
  res.status(200).sendFile(filePath)
})
```

–î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ë–î:

```javascript
app.use(onError)

try {
  await mongoose.connect(MONGODB_URI, {
    useNewUrlParser: true,
    useUnifiedTopology: true
  })
  console.log('üöÄ Connected')
} catch (e) {
  onError(e)
}
```

–°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å–µ—Ä–≤–µ—Ä–∞ –∏ `Socket.io` –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:

```javascript
const server = createServer(app)

const io = new Server(server, {
  cors: ALLOWED_ORIGIN,
  serveClient: false
})

io.on('connection', (socket) => {
  onConnection(io, socket)
})
```

–ù–∞–∫–æ–Ω–µ—Ü, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä:

```javascript
const PORT = process.env.PORT || 4000
server.listen(PORT, () => {
  console.log(`üöÄ Server started on port ${PORT}`)
})
```

<spoiler title="–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞:">

```javascript
import cors from 'cors'
import express from 'express'
import { createServer } from 'http'
import mongoose from 'mongoose'
import { Server } from 'socket.io'
import { ALLOWED_ORIGIN, MONGODB_URI } from './config.js'
import onConnection from './socket_io/onConnection.js'
import { getFilePath } from './utils/file.js'
import onError from './utils/onError.js'
import upload from './utils/upload.js'

const app = express()

app.use(
  cors({
    origin: ALLOWED_ORIGIN
  })
)
app.use(express.json())

app.use('/upload', upload.single('file'), (req, res) => {
  if (!req.file) return res.sendStatus(400)

  const relativeFilePath = req.file.path
    .replace(/\\/g, '/')
    .split('server/files')[1]

  res.status(201).json(relativeFilePath)
})

app.use('/files', (req, res) => {
  const filePath = getFilePath(req.url)

  res.status(200).sendFile(filePath)
})

app.use(onError)

try {
  await mongoose.connect(MONGODB_URI, {
    useNewUrlParser: true,
    useUnifiedTopology: true
  })
  console.log('üöÄ Connected')
} catch (e) {
  onError(e)
}

const server = createServer(app)

const io = new Server(server, {
  cors: ALLOWED_ORIGIN,
  serveClient: false
})

io.on('connection', (socket) => {
  onConnection(io, socket)
})

const PORT = process.env.PORT || 4000
server.listen(PORT, () => {
  console.log(`üöÄ Server started on port ${PORT}`)
})
```

</spoiler>

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ä–∞–±–æ—Ç—É —Å —Å–æ–∫–µ—Ç–∞–º–∏ (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `socket_io`).

–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (`onConnection.js`):

```javascript
import userHandlers from './handlers/user.handlers.js'
import messageHandlers from './handlers/message.handlers.js'

export default function onConnection(io, socket) {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const { roomId, userName } = socket.handshake.query

  // –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Ö –≤ –æ–±—ä–µ–∫—Ç —Å–æ–∫–µ—Ç–∞
  socket.roomId = roomId
  socket.userName = userName

  // –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
  socket.join(roomId)

  // —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  userHandlers(io, socket)

  // —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
  messageHandlers(io, socket)
}
```

–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`handlers/user.handlers.js`):

```javascript
// "—Ö—Ä–∞–Ω–∏–ª–∏—â–µ" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const users = {}

export default function userHandlers(io, socket) {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –æ–±—ä–µ–∫—Ç–∞ —Å–æ–∫–µ—Ç–∞
  const { roomId, userName } = socket

  // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  if (!users[roomId]) {
    users[roomId] = []
  }

  // —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  const updateUserList = () => {
    // —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ –∫–æ–º–Ω–∞—Ç–µ
    io.to(roomId).emit('user_list:update', users[roomId])
  }

  // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  socket.on('user:add', async (user) => {
    // —Å–æ–æ–±—â–∞–µ–º –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ–± —ç—Ç–æ–º
    socket.to(roomId).emit('log', `User ${userName} connected`)

    // –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–∫–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user.socketId = socket.id

    // –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    users[roomId].push(user)

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    updateUserList()
  })

  // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  socket.on('disconnect', () => {
    if (!users[roomId]) return

    // —Å–æ–æ–±—â–∞–µ–º –æ–± —ç—Ç–æ–º –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    socket.to(roomId).emit('log', `User ${userName} disconnected`)

    // —É–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    users[roomId] = users[roomId].filter((u) => u.socketId !== socket.id)

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    updateUserList()
  })
}
```

–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π (`handlers/message.handlers.js`):

```javascript
import Message from '../../models/message.model.js'
import { removeFile } from '../../utils/file.js'
import onError from '../../utils/onError.js'

// "—Ö—Ä–∞–Ω–∏–ª–∏—â–µ" –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
const messages = {}

export default function messageHandlers(io, socket) {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã
  const { roomId } = socket

  // —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
  const updateMessageList = () => {
    io.to(roomId).emit('message_list:update', messages[roomId])
  }

  // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
  socket.on('message:get', async () => {
    try {
      // –ø–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ `id` –∫–æ–º–Ω–∞—Ç—ã
      const _messages = await Message.find({
        roomId
      })
      // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–æ–±—â–µ–Ω–∏–π
      messages[roomId] = _messages

      // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
      updateMessageList()
    } catch (e) {
      onError(e)
    }
  })

  // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  socket.on('message:add', (message) => {
    // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∂–¥–∞—Ç—å –∑–∞–ø–∏—Å–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î
    Message.create(message).catch(onError)

    // —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
    message.createdAt = Date.now()

    // —Å–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∏,
    // —Ç.–µ. –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è, —á—Ç–æ –∑–∞–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î –±—É–¥–µ—Ç —É—Å–ø–µ—à–Ω–æ–π
    messages[roomId].push(message)

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
    updateMessageList()
  })

  // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  socket.on('message:remove', (message) => {
    const { messageId, messageType, textOrPathToFile } = message

    // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∂–¥–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –ë–î
    // –∏ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª–æ–º)
    Message.deleteOne({ messageId })
      .then(() => {
        if (messageType !== 'text') {
          removeFile(textOrPathToFile)
        }
      })
      .catch(onError)

    // —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∏
    messages[roomId] = messages[roomId].filter((m) => m.messageId !== messageId)

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
    updateMessageList()
  })
}
```

–ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∏ —É–¥–∞–ª–µ–Ω–∏—é —Å–æ–æ–±—â–µ–Ω–∏—è —è –∏—Å—Ö–æ–¥–∏–ª –∏–∑ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –ø–µ—Ä–µ–¥–∞—á–µ –¥–∞–Ω–Ω—ã—Ö —è–≤–ª—è–µ—Ç—Å—è –±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–π, —á–µ–º –Ω–µ—É–¥–∞—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –ë–î, –ø–æ—Å–∫–æ–ª—å–∫—É —Ä–µ—á—å –∏–¥–µ—Ç –æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –í –∏–¥–µ–∞–ª–µ, —Ö–æ—Ä–æ—à–æ –∏–º–µ—Ç—å –≤ –ë–î –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å–ª—É—á–∞–µ–≤ –Ω–µ—É–¥–∞—á–Ω–æ–π –∑–∞–ø–∏—Å–∏/—É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.

–≠—Ç–æ –≤—Å–µ, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞.

## –ö–ª–∏–µ–Ω—Ç

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `client` –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
cd client

# –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
yarn add react-router-dom zustand react-icons emoji-mart react-speech-kit react-timeago socket.io-client nanoid
# or
npm i ...

# –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
yarn add -D sass
# or
npm i -D sass
```

- [react-router-dom](https://reactrouter.com/) - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞;
- [zustand](https://github.com/pmndrs/zustand) - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è;
- [react-icons](https://react-icons.github.io/react-icons/) - –±–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä –∏–∫–æ–Ω–æ–∫ –≤ –≤–∏–¥–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤;
- [emoji-mart](https://github.com/missive/emoji-mart) - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —ç–º–æ–¥–∑–∏;
- [react-speech-kit](https://github.com/MikeyParton/react-speech-kit) - –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ [`Web Speech API`](https://developer.mozilla.org/ru/docs/Web/API/Web_Speech_API) –¥–ª—è `react`;
- [react-timeago](https://github.com/nmn/react-timeago) - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏;
- [socket.io-client](https://www.npmjs.com/package/socket.io-client) - –∫–ª–∏–µ–Ω—Ç `socket.io`;
- [nanoid](https://www.npmjs.com/package/nanoid) - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤;
- [sass](https://sass-scss.ru/) - [–ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä](https://developer.mozilla.org/ru/docs/Glossary/CSS_preprocessor) `CSS`.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src` –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π:

```
- api
  - file.api.js - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- components
  - NameInput
    - NameInput.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - Room
    - MessageInput
      - EmojiMart
        - EmojiMart.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —ç–º–æ–¥–∑–∏
      - FileInput
        - FileInput.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤—ã–±–æ—Ä–∞ (–ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è) —Ñ–∞–π–ª–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        - FilePreview.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞
      - Recorder
        - Recorder.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ –∏–ª–∏ –≤–∏–¥–µ–æ–∑–∞–ø–∏—Å–∏
        - RecordingModal.js - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∑–∞–ø–∏—Å–∏
      - MessageInput.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –≤—ã–±–æ—Ä–∞ —ç–º–æ–¥–∑–∏, –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ –∏–ª–∏ –≤–∏–¥–µ–æ–∑–∞–ø–∏—Å–∏
    - MessageList
      - MessageItem.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      - MessageList.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    - UserList
      - UserList - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - Room.js - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∫–æ–º–Ω–∞—Ç—ã
  - index.js - –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- hooks
  - useChat.js - —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–∫–µ—Ç–∞–º–∏
  - useStore.js - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ —Ö—É–∫–∞
- pages
  - Home
    - Home.js - –¥–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  - index.js - –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç —Å—Ç—Ä–∞–Ω–∏—Ü
- routes
  - app.routes.js - —Ä–æ—É—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- styles - —Å—Ç–∏–ª–∏ (—è –Ω–µ –±—É–¥—É –Ω–∞ –Ω–∏—Ö –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è, –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Ö –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º –ø—Ä–æ–µ–∫—Ç–∞)
- utils
  - recording.js - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ –∏–ª–∏ –≤–∏–¥–µ–æ–∑–∞–ø–∏—Å–∏
  - storage.js - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
- App.js - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- App.scss - —Å—Ç–∏–ª–∏
- constants.js - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- index.js - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∫–ª–∏–µ–Ω—Ç–∞
```

–ù–∞—á–Ω–µ–º —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`App.js`):

```javascript
import { BrowserRouter } from 'react-router-dom'
import AppRoutes from 'routes/app.routes'
import './App.scss'

function App() {
  return (
    <BrowserRouter>
      <AppRoutes />
    </BrowserRouter>
  )
}

export default App
```

–ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º —Ä–æ—É—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —ç—Ç–∏ —Ä–æ—É—Ç—ã (`routes/app.routes.js`):

```javascript
import { Home } from 'pages'
import { Route, Routes } from 'react-router-dom'

const AppRoutes = () => (
  <Routes>
    <Route path='*' element={<Home />} />
  </Routes>
)

export default AppRoutes
```

–í—Å–µ –¥–æ—Ä–æ–≥–∏, —Ç.–µ. –ø—É—Ç–∏ –≤–µ–¥—É—Ç –≤ –†–∏–º, —Ç.–µ. –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.

–ó–∞—á–µ–º –Ω–∞–º —Ä–æ—É—Ç–µ—Ä, —Å–ø—Ä–æ—Å–∏—Ç–µ –≤—ã. –ü–æ –±–æ–ª—å—à–µ–º—É —Å—á–µ—Ç—É, –æ–Ω –Ω–∞–º –Ω–µ –Ω—É–∂–µ–Ω, –Ω–æ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ö–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π.

–í–∑–≥–ª—è–Ω–µ–º –Ω–∞ –¥–æ–º–∞—à–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (`pages/Home/Home.js`):

```javascript
import { NameInput, Room } from 'components'
import { USER_KEY } from 'constants'
import storage from 'utils/storage'

export const Home = () => {
  const user = storage.get(USER_KEY)

  return user ? <Room /> : <NameInput />
}
```

–ú—ã –ø—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è —Ç–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ–º–Ω–∞—Ç—ã –∏–ª–∏ –∏–Ω–ø—É—Ç –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º (`utils/storage.js`):

```javascript
const storage = {
  get: (key) =>
    window.localStorage.getItem(key)
      ? JSON.parse(window.localStorage.getItem(key))
      : null,
  set: (key, value) => window.localStorage.setItem(key, JSON.stringify(value))
}

export default storage
```

–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`constants.js`):

```javascript
export const USER_KEY = 'chat_app_user'
export const SERVER_URI = 'http://localhost:4000'
```

–ó–∞–π–º–µ–º—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (`components`).

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`NameInput/NameInput.js`):

```javascript
// –∏–º–ø–æ—Ä—Ç—ã
import { USER_KEY } from 'constants'
import { nanoid } from 'nanoid'
import { useEffect, useState } from 'react'
import storage from 'utils/storage'

export const NameInput = () => {
  // –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  const [formData, setFormData] = useState({
    userName: '',
    // —Ñ–∏–∫—Å–∏—Ä—É–µ–º ("—Ö–∞—Ä–¥–∫–æ–¥–∏–º") –Ω–∞–∑–≤–∞–Ω–∏–µ (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä) –∫–æ–º–Ω–∞—Ç—ã
    roomId: 'main_room'
  })
  // —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏
  const [submitDisabled, setSubmitDisabled] = useState(true)

  // –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã —è–≤–ª—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏
  useEffect(() => {
    const isSomeFieldEmpty = Object.values(formData).some((v) => !v.trim())
    setSubmitDisabled(isSomeFieldEmpty)
  }, [formData])

  // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
  const onChange = ({ target: { name, value } }) => {
    setFormData({ ...formData, [name]: value })
  }

  // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const onSubmit = (e) => {
    e.preventDefault()
    if (submitDisabled) return

    // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userId = nanoid()

    // –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    storage.set(USER_KEY, {
      userId,
      userName: formData.userName,
      roomId: formData.roomId
    })

    // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã "–ø–æ–ø–∞—Å—Ç—å" –≤ –∫–æ–º–Ω–∞—Ç—É
    window.location.reload()
  }

  return (
    <div className='container name-input'>
      <h2>Welcome</h2>
      <form onSubmit={onSubmit} className='form name-room'>
        <div>
          <label htmlFor='userName'>Enter your name</label>
          <input
            type='text'
            id='userName'
            name='userName'
            minLength={2}
            required
            value={formData.userName}
            onChange={onChange}
          />
        </div>
        {/* —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã (–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è) */}
        <div class='visually-hidden'>
          <label htmlFor='roomId'>Enter room ID</label>
          <input
            type='text'
            id='roomId'
            name='roomId'
            minLength={4}
            required
            value={formData.roomId}
            onChange={onChange}
          />
        </div>
        <button disabled={submitDisabled} className='btn chat'>
          Chat
        </button>
      </form>
    </div>
  )
}
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ–º–Ω–∞—Ç—ã (`Room/Room.js`):

```javascript
import useChat from 'hooks/useChat'
import MessageInput from './MessageInput/MessageInput'
import MessageList from './MessageList/MessageList'
import UserList from './UserList/UserList'

export const Room = () => {
  // –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –º–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
  const { users, messages, log, sendMessage, removeMessage } = useChat()
  // –∏ –ø–µ—Ä–µ–¥–∞–µ–º –∏—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
  return (
    <div className='container chat'>
      <div className='container message'>
        <MessageList
          log={log}
          messages={messages}
          removeMessage={removeMessage}
        />
        <MessageInput sendMessage={sendMessage} />
      </div>
      <UserList users={users} />
    </div>
  )
}
```

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–∫–µ—Ç–∞–º–∏ (`hooks/useChat.js`):

```javascript
import { SERVER_URI, USER_KEY } from 'constants'
import { useEffect, useRef, useState } from 'react'
import { io } from 'socket.io-client'
import storage from 'utils/storage'

export default function useChat() {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const user = storage.get(USER_KEY)
  // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  const [users, setUsers] = useState([])
  // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
  const [messages, setMessages] = useState([])
  // —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  const [log, setLog] = useState(null)
  // –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–æ–∫–µ—Ç–∞
  const { current: socket } = useRef(
    io(SERVER_URI, {
      query: {
        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        roomId: user.roomId,
        userName: user.userName
      }
    })
  )

  // —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
  useEffect(() => {
    // —Å–æ–æ–±—â–∞–µ–º –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    socket.emit('user:add', user)

    // –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –ë–î
    socket.emit('message:get')

    // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    socket.on('log', (log) => {
      setLog(log)
    })

    // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    socket.on('user_list:update', (users) => {
      setUsers(users)
    })

    // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    socket.on('message_list:update', (messages) => {
      setMessages(messages)
    })
  }, [])

  // –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
  const sendMessage = (message) => {
    socket.emit('message:add', message)
  }

  // –º–µ—Ç–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
  const removeMessage = (message) => {
    socket.emit('message:remove', message)
  }

  return { users, messages, log, sendMessage, removeMessage }
}
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`UserList/UserList.js`):

```javascript
import { AiOutlineUser } from 'react-icons/ai'

export default function UserList({ users }) {
  return (
    <div className='container user'>
      <h2>Users</h2>
      <ul className='list user'>
        {users.map(({ userId, userName }) => (
          <li key={userId} className='item user'>
            <AiOutlineUser className='icon user' />
            {userName}
          </li>
        ))}
      </ul>
    </div>
  )
}
```

–ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫ –∏–º–µ–Ω.

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (`MessageList/MessageList.js`):

```javascript
import { useEffect, useRef } from 'react'
import MessageItem from './MessageItem'

export default function MessageList({ log, messages, removeMessage }) {
  // –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  const logRef = useRef()
  // –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
  const bottomRef = useRef()

  // –≤—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –∫ –∫–æ–Ω—Ü—É —Å–ø–∏—Å–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  // —ç—Ç–æ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
  // –∫–æ–≥–¥–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞ –Ω–µ –±—É–¥—É—Ç —É—Å–ø–µ–≤–∞—Ç—å —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
  useEffect(() => {
    bottomRef.current.scrollIntoView({
      behavior: 'smooth'
    })
  }, [messages])

  // –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  useEffect(() => {
    if (log) {
      logRef.current.style.opacity = 0.8
      logRef.current.style.zIndex = 1

      const timerId = setTimeout(() => {
        logRef.current.style.opacity = 0
        logRef.current.style.zIndex = -1

        clearTimeout(timerId)
      }, 1500)
    }
  }, [log])

  return (
    <div className='container message'>
      <h2>Messages</h2>
      <ul className='list message'>
        {/* –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è */}
        {messages.map((message) => (
          <MessageItem
            key={message.messageId}
            message={message}
            removeMessage={removeMessage}
          />
        ))}

        <p ref={bottomRef}></p>

        <p ref={logRef} className='log'>
          {log}
        </p>
      </ul>
    </div>
  )
}
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (`MessageList/MessageItem.js`):

```javascript
import { SERVER_URI, USER_KEY } from 'constants'
import { CgTrashEmpty } from 'react-icons/cg'
import { GiSpeaker } from 'react-icons/gi'
import { useSpeechSynthesis } from 'react-speech-kit'
import TimeAgo from 'react-timeago'
import storage from 'utils/storage'

export default function MessageItem({ message, removeMessage }) {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const user = storage.get(USER_KEY)
  // —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ—á—å
  const { speak, voices } = useSpeechSynthesis()
  // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  const lang = document.documentElement.lang || 'en'
  // –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –≥–æ–ª–æ—Å –æ—Ç –≥—É–≥–ª–∞
  const voice = voices.find(
    (v) => v.lang.includes(lang) && v.name.includes('Google')
  )

  // —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  let element

  // –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø –∏ —Ç–µ–∫—Å—Ç –∏–ª–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
  const { messageType, textOrPathToFile } = message

  // —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
  const pathToFile = `${SERVER_URI}/files${textOrPathToFile}`

  // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  switch (messageType) {
    case 'text':
      element = (
        <>
          <button
            className='btn'
            // –æ–∑–≤—É—á–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
            onClick={() => speak({ text: textOrPathToFile, voice })}
          >
            <GiSpeaker className='icon speak' />
          </button>
          <p>{textOrPathToFile}</p>
        </>
      )
      break
    case 'image':
      element = <img src={pathToFile} alt='' />
      break
    case 'audio':
      element = <audio src={pathToFile} controls></audio>
      break
    case 'video':
      element = <video src={pathToFile} controls></video>
      break
    default:
      return null
  }

  // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  const isMyMessage = user.userId === message.userId

  return (
    <li className={`item message ${isMyMessage ? 'my' : ''}`}>
      <p className='username'>{isMyMessage ? 'Me' : message.userName}</p>

      <div className='inner'>
        {element}

        {isMyMessage && (
          {/* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è */}
          <button className='btn' onClick={() => removeMessage(message)}>
            <CgTrashEmpty className='icon remove' />
          </button>
        )}
      </div>

      <p className='datetime'>
        <TimeAgo date={message.createdAt} />
      </p>
    </li>
  )
}
```

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ —Ñ–æ—Ä–º–µ —Ö—É–∫–∞ (`hooks/useStore.js`):

```javascript
import create from 'zustand'

const useStore = create((set, get) => ({
  // —Ñ–∞–π–ª
  file: null,
  // –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞
  showPreview: false,
  // –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å —ç–º–æ–¥–∑–∏
  showEmoji: false,
  // –º–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞
  setFile: (file) => {
    // –ø–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ñ–∞–π–ª
    const prevFile = get().file
    if (prevFile) {
      // https://w3c.github.io/FileAPI/#creating-revoking
      // —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
      URL.revokeObjectURL(prevFile)
    }
    // –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª
    set({ file })
  },
  // –º–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–≤—å—é
  setShowPreview: (showPreview) => set({ showPreview }),
  // –º–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–º–æ–¥–∑–∏
  setShowEmoji: (showEmoji) => set({ showEmoji })
}))

export default useStore
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (`MessageInput/MessageInput.js`):

```javascript
import fileApi from 'api/file.api'
import { USER_KEY } from 'constants'
import useStore from 'hooks/useStore'
import { nanoid } from 'nanoid'
import { useEffect, useRef, useState } from 'react'
import { FiSend } from 'react-icons/fi'
import storage from 'utils/storage'
import EmojiMart from './EmojiMart/EmojiMart'
import FileInput from './FileInput/FileInput'
import Recorder from './Recorder/Recorder'

export default function MessageInput({ sendMessage }) {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const user = storage.get(USER_KEY)
  // –∏–∑–≤–ª–µ–∫–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const state = useStore((state) => state)
  const {
    file,
    setFile,
    showPreview,
    setShowPreview,
    showEmoji,
    setShowEmoji
  } = state
  // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  const [text, setText] = useState('')
  // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–Ω–æ–ø–∫–∏
  const [submitDisabled, setSubmitDisabled] = useState(true)
  // –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–Ω–ø—É—Ç –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  const inputRef = useRef()

  // –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏–±–æ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –ª–∏–±–æ —Ñ–∞–π–ª
  useEffect(() => {
    setSubmitDisabled(!text.trim() && !file)
  }, [text, file])

  // –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–µ–≤—å—é –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ñ–∞–π–ª–∞
  useEffect(() => {
    setShowPreview(file)
  }, [file, setShowPreview])

  // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
  const onSubmit = async (e) => {
    e.preventDefault()
    if (submitDisabled) return

    // –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const { userId, userName, roomId } = user
    let message = {
      messageId: nanoid(),
      userId,
      userName,
      roomId
    }

    if (!file) {
      // —Ç–∏–ø–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç
      message.messageType = 'text'
      message.textOrPathToFile = text
    } else {
      // —Ç–∏–ø–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª
      try {
        // –∑–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ–ª—É—á–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –Ω–µ–º—É
        const path = await fileApi.upload({ file, roomId })
        // –ø–æ–ª—É—á–∞–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
        const type = file.type.split('/')[0]

        message.messageType = type
        message.textOrPathToFile = path
      } catch (e) {
        console.error(e)
      }
    }

    // —Å–∫—Ä—ã–≤–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —ç–º–æ–¥–∑–∏, –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫—Ä—ã—Ç
    if (showEmoji) {
      setShowEmoji(false)
    }

    // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    sendMessage(message)

    // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    setText('')
    setFile(null)
  }

  return (
    <form onSubmit={onSubmit} className='form message'>
      <EmojiMart setText={setText} messageInput={inputRef.current} />
      <FileInput />
      <Recorder />
      <input
        type='text'
        autoFocus
        placeholder='Message...'
        value={text}
        onChange={(e) => setText(e.target.value)}
        ref={inputRef}
        // –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ñ–∞–π–ª–∞ –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–µ–ª—å–∑—è
        disabled={showPreview}
      />
      <button className='btn' type='submit' disabled={submitDisabled}>
        <FiSend className='icon' />
      </button>
    </form>
  )
}
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–º–æ–¥–∑–∏ (`MessageInput/EmojiMart/EmojiMart.js`):

```javascript
import { Picker } from 'emoji-mart'
import 'emoji-mart/css/emoji-mart.css'
import useStore from 'hooks/useStore'
import { useCallback, useEffect } from 'react'
import { BsEmojiSmile } from 'react-icons/bs'

export default function EmojiMart({ setText, messageInput }) {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const { showEmoji, setShowEmoji, showPreview } = useStore(
    ({ showEmoji, setShowEmoji, showPreview }) => ({
      showEmoji,
      setShowEmoji,
      showPreview
    })
  )

  // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏ `Esc`
  const onKeydown = useCallback(
    (e) => {
      if (e.key === 'Escape') {
        setShowEmoji(false)
      }
    },
    [setShowEmoji]
  )

  // —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ `window`
  useEffect(() => {
    window.addEventListener('keydown', onKeydown)

    return () => {
      window.removeEventListener('keydown', onKeydown)
    }
  }, [onKeydown])

  // –º–µ—Ç–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–º–æ–¥–∑–∏ –∫ —Ç–µ–∫—Å—Ç—É —Å–æ–æ–±—â–µ–Ω–∏—è
  const onSelect = ({ native }) => {
    setText((text) => text + native)
    messageInput.focus()
  }

  return (
    <div className='container emoji'>
      <button
        className='btn'
        type='button'
        {/* –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ */}
        onClick={() => setShowEmoji(!showEmoji)}
        disabled={showPreview}
      >
        <BsEmojiSmile className='icon' />
      </button>
      {showEmoji && (
        <Picker
          onSelect={onSelect}
          emojiSize={20}
          showPreview={false}
          perLine={6}
        />
      )}
    </div>
  )
}
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ (`MessageInput/FileInput/FileInput.js`):

```javascript
import useStore from 'hooks/useStore'
import { useEffect, useRef } from 'react'
import { MdAttachFile } from 'react-icons/md'
import FilePreview from '../FilePreview/FilePreview'

export default function FileInput() {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º —Ñ–∞–π–ª –∏ –º–µ—Ç–æ–¥ –¥–ª—è –µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const { file, setFile } = useStore(({ file, setFile }) => ({ file, setFile }))
  // –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–Ω–ø—É—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞
  // –º—ã —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–ø—É—Ç –∑–∞ –∫–Ω–æ–ø–∫–æ–π
  const inputRef = useRef()

  // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–ø—É—Ç–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–∞
  useEffect(() => {
    if (!file) {
      inputRef.current.value = ''
    }
  }, [file])

  return (
    <div className='container file'>
      <input
        type='file'
        accept='image/*, audio/*, video/*'
        onChange={(e) => setFile(e.target.files[0])}
        className='visually-hidden'
        ref={inputRef}
      />
      <button
        type='button'
        className='btn'
        // –ø–µ—Ä–µ–¥–∞–µ–º –∫–ª–∏–∫ –∏–Ω–ø—É—Ç—É
        onClick={() => inputRef.current.click()}
      >
        <MdAttachFile className='icon' />
      </button>

      {file && <FilePreview />}
    </div>
  )
}
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞ (`MessageInput/FileInput/FilePreview.js`):

```javascript
import useStore from 'hooks/useStore'
import { useEffect, useState } from 'react'
import { AiOutlineClose } from 'react-icons/ai'

export default function FilePreview() {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º —Ñ–∞–π–ª –∏ –º–µ—Ç–æ–¥ –¥–ª—è –µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const { file, setFile } = useStore(({ file, setFile }) => ({ file, setFile }))
  // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ñ–∞–π–ª–∞
  const [src, setSrc] = useState()
  // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
  const [type, setType] = useState()

  // –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ñ–∞–π–ª–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∏ —Ç–∏–ø —Ñ–∞–π–ª–∞
  useEffect(() => {
    if (file) {
      setSrc(URL.createObjectURL(file))
      setType(file.type.split('/')[0])
    }
  }, [file])

  // —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
  let element

  switch (type) {
    case 'image':
      element = <img src={src} alt={file.name} />
      break
    case 'audio':
      element = <audio src={src} controls></audio>
      break
    case 'video':
      element = <video src={src} controls></video>
      break
    default:
      element = null
      break
  }

  return (
    <div className='container preview'>
      {element}

      <button
        type='button'
        className='btn close'
        // –æ–±–Ω—É–ª—è–µ–º —Ñ–∞–π–ª –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø—Ä–µ–≤—å—é
        onClick={() => setFile(null)}
      >
        <AiOutlineClose className='icon close' />
      </button>
    </div>
  )
}
```

–ù–∞–º –æ—Å—Ç–∞–ª–æ—Å—å —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ –∏–ª–∏ –≤–∏–¥–µ–æ–∑–∞–ø–∏—Å–∏. –ù–æ —Å–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã (`utils/recording.js`):

```javascript
// https://www.w3.org/TR/mediastream-recording/
// –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–∫–æ—Ä–¥–µ—Ä–∞, —á–∞—Å—Ç–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–æ—Ç–æ–∫—É –¥–∞–Ω–Ω—ã—Ö
let mediaRecorder = null
let mediaChunks = []
let mediaConstraints = null

// https://w3c.github.io/mediacapture-main/#constrainable-interface
// —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫—É
export const audioConstraints = {
  audio: {
    echoCancellation: true,
    autoGainControl: true,
    noiseSuppression: true
  }
}

// —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –º–µ–¥–∏–∞–ø–æ—Ç–æ–∫—É (–∞—É–¥–∏–æ + –≤–∏–¥–µ–æ)
export const videoConstraints = {
  ...audioConstraints,
  video: {
    width: 1920,
    height: 1080,
    frameRate: 60.0
  }
}

// –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏
export const isRecordingStarted = () => !!mediaRecorder

// –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏
export const pauseRecording = () => {
  mediaRecorder.pause()
}

// –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
export const resumeRecording = () => {
  mediaRecorder.resume()
}

// –º–µ—Ç–æ–¥ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏
// –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ—Ç–æ–∫—É
export const startRecording = async (constraints) => {
  mediaConstraints = constraints

  try {
    // https://w3c.github.io/mediacapture-main/#dom-mediadevices-getusermedia
    // –ø–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const stream = await navigator.mediaDevices.getUserMedia(constraints)
    // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–π –∑–∞–ø–∏—Å–∏
    const type = constraints.video ? 'video' : 'audio'

    // https://www.w3.org/TR/mediastream-recording/#mediarecorder-constructor
    // —Å–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —Ä–µ–∫–æ—Ä–¥–µ—Ä–∞
    mediaRecorder = new MediaRecorder(stream, { mimeType: `${type}/webm` })

    // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
    mediaRecorder.ondataavailable = ({ data }) => {
      mediaChunks.push(data)
    }

    // –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å
    mediaRecorder.start(250)

    // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ—Ç–æ–∫
    return stream
  } catch (e) {
    console.error(e)
  }
}

// –º–µ—Ç–æ–¥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
export const stopRecording = () => {
  // –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∫–æ—Ä–¥–µ—Ä
  mediaRecorder.stop()
  // –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç—Ä–µ–∫–∏ –∏–∑ –ø–æ—Ç–æ–∫–∞
  mediaRecorder.stream.getTracks().forEach((t) => {
    t.stop()
  })

  // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–ø–∏—Å–∏
  const type = mediaConstraints.video ? 'video' : 'audio'
  // https://w3c.github.io/FileAPI/#file-constructor
  // —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª
  const file = new File(mediaChunks, 'my_record.webm', {
    type: `${type}/webm`
  })

  // –±–µ–∑ —ç—Ç–æ–≥–æ –∑–∞–ø–∏—Å—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
  mediaRecorder.ondataavailable = null
  // –æ–±–Ω—É–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥–µ—Ä
  mediaRecorder = null
  // –æ—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤ —Å –¥–∞–Ω–Ω—ã–º–∏
  mediaChunks = []

  // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–∞–π–ª
  return file
}
```

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (`MessageInput/Recorder/Recorder.js`):

```javascript
import useStore from 'hooks/useStore'
import { useState } from 'react'
import { RiRecordCircleLine } from 'react-icons/ri'
import RecordingModal from './RecordingModal'

export default function Recorder() {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const showPreview = useStore(({ showPreview }) => showPreview)
  // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  const [showModal, setShowModal] = useState(false)

  return (
    <div className='container recorder'>
      <button
        type='button'
        className='btn'
        // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
        onClick={() => setShowModal(true)}
        // –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –ø—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞
        disabled={showPreview}
      >
        <RiRecordCircleLine className='icon' />
      </button>
      {showModal && <RecordingModal setShowModal={setShowModal} />}
    </div>
  )
}
```

–û–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —á–∞—Å—Ç–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (`MessageInput/Recorder/RecordingModal.js`):

```javascript
import useStore from 'hooks/useStore'
import { useRef, useState } from 'react'
import { BsFillPauseFill, BsFillPlayFill, BsFillStopFill } from 'react-icons/bs'
import {
  audioConstraints,
  isRecordingStarted,
  pauseRecording,
  resumeRecording,
  startRecording,
  stopRecording,
  videoConstraints
} from 'utils/recording'

export default function RecordingModal({ setShowModal }) {
  // –∏–∑–≤–ª–µ–∫–∞–µ–º –º–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  const setFile = useStore(({ setFile }) => setFile)
  // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–æ—Ç–æ–∫—É –¥–∞–Ω–Ω—ã—Ö
  // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞—É–¥–∏–æ–∑–∞–ø–∏—Å—å
  const [constraints, setConstraints] = useState(audioConstraints)
  // –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏
  const [recording, setRecording] = useState(false)
  // –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∑–∞–ø–∏—Å–∏
  const selectBlockRef = useRef()
  // –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç `video`
  const videoRef = useRef()

  // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–æ—Ç–æ–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –∑–∞–ø–∏—Å–∏
  const onChange = ({ target: { value } }) =>
    value === 'audio'
      ? setConstraints(audioConstraints)
      : setConstraints(videoConstraints)

  // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
  const pauseResume = () => {
    if (recording) {
      pauseRecording()
    } else {
      resumeRecording()
    }
    setRecording(!recording)
  }

  // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏
  const start = async () => {
    if (isRecordingStarted()) {
      return pauseResume()
    }

    // –ø–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫
    const stream = await startRecording(constraints)

    // –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏
    setRecording(true)

    // —Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∑–∞–ø–∏—Å–∏
    selectBlockRef.current.style.display = 'none'

    // –µ—Å–ª–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤–∏–¥–µ–æ–∑–∞–ø–∏—Å—å
    if (constraints.video && stream) {
      videoRef.current.style.display = 'block'
      // –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Ç–æ–∫ –≤ —ç–ª–µ–º–µ–Ω—Ç `video`
      videoRef.current.srcObject = stream
    }
  }

  // —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
  const stop = () => {
    // –ø–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª
    const file = stopRecording()

    // –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏
    setRecording(false)

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª
    setFile(file)

    // —Å–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
    setShowModal(false)
  }

  return (
    <div
      className='overlay'
      onClick={(e) => {
        // —Å–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –∑–∞ –µ–≥–æ –ø—Ä–µ–¥–µ–ª–∞–º–∏
        if (e.target.className !== 'overlay') return
        setShowModal(false)
      }}
    >
      <div className='modal'>
        <div ref={selectBlockRef}>
          <h2>Select type</h2>
          <select onChange={onChange}>
            <option value='audio'>Audio</option>
            <option value='video'>Video</option>
          </select>
        </div>

        {/* –≤–æ—Ç –¥–ª—è —á–µ–≥–æ –Ω–∞–º –Ω—É–∂–Ω—ã 2 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏ */}
        {isRecordingStarted() && <p>{recording ? 'Recording...' : 'Paused'}</p>}

        <video ref={videoRef} autoPlay muted />

        <div className='controls'>
          <button className='btn play' onClick={start}>
            {recording ? (
              <BsFillPauseFill className='icon' />
            ) : (
              <BsFillPlayFill className='icon' />
            )}
          </button>
          {isRecordingStarted() && (
            <button className='btn stop' onClick={stop}>
              <BsFillStopFill className='icon' />
            </button>
          )}
        </div>
      </div>
    </div>
  )
}
```

–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ, –º—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –Ω–∞—à–µ–≥–æ –Ω–µ–±–æ–ª—å—à–æ–≥–æ, –Ω–æ, —Å–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å, –¥–æ–≤–æ–ª—å–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º –µ–≥–æ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ù–∞—Ö–æ–¥—è—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞, –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É `yarn dev` –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º 2 –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000` (–æ–¥–Ω—É –∏–∑ –≤–∫–ª–∞–¥–æ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ).

–í–≤–æ–¥–∏–º –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≤—Ö–æ–¥–∏–º –≤ –∫–æ–º–Ω–∞—Ç—É:

<img src="https://habrastorage.org/webt/qe/9u/4e/qe9u4eaz8am9msuolxa-a8fq95w.png" />
<br />

–û–±–º–µ–Ω–∏–≤–∞–µ–º—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏:

<img src="https://habrastorage.org/webt/yd/uw/-u/yduw-udx--cle5j2whsigtdgjl0.png" />
<br />

–û–±–º–µ–Ω–∏–≤–∞–µ–º—Å—è —ç–º–æ–¥–∑–∏:

<img src="https://habrastorage.org/webt/x2/gb/8z/x2gb8zi6norlv6mky2aqxcaeahe.png" />
<br />

–û–±–º–µ–Ω–∏–≤–∞–µ–º—Å—è —Ñ–∞–π–ª–∞–º–∏:

<img src="https://habrastorage.org/webt/4v/as/aa/4vasaahjqmllndhg3cuvl8nbhr0.png" />
<br />

–û–±–º–µ–Ω–∏–≤–∞–µ–º—Å—è –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ –∑–∞–ø–∏—Å—è–º–∏:

<img src="https://habrastorage.org/webt/po/be/5i/pobe5ild8ddh5omzggi-5v9gnls.png" />
<br />

<img src="https://habrastorage.org/webt/1t/-i/9x/1t-i9x_hc_b5al2z25m9r87wz-y.png" />
<br />

–£–¥–∞–ª—è–µ–º –ø–∞—Ä–æ—á–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π:

<img src="https://habrastorage.org/webt/pk/eo/8g/pkeo8gzcyyq7gx0fcocbzwnzbse.png" />
<br />

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è.

–ü–æ—Å–∫–æ–ª—å–∫—É, —É –Ω–∞—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–º–µ—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—É `id`, –Ω–∏—á—Ç–æ –Ω–µ –º–µ—à–∞–µ—Ç –Ω–∞–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –¥–æ–±–∞–≤–∏–≤ –≤ –Ω–µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–æ–≤ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º `WebRTC`, –æ —á–µ–º —è —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª –≤ [—ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ](https://habr.com/ru/company/timeweb/blog/649369/). –ë—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å —ç—Ç–æ –≤–∞—à–∏–º –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º.

The End.